import{a as u}from"./chunk-GSMGX6RX.js";import{b as a,c as l}from"./chunk-FBOU2ALC.js";import{C as n,G as r,d as h,ha as o,zb as c}from"./chunk-E4UPHNBD.js";var L=(()=>{class i{constructor(){this.http=r(c),this.api=r(l),this.notificationService=r(a),this.dateService=r(u),this.host=this.api.host,this.deliverForm=o(this.resetDeliverForm()),this.deliverInvoice=new h([]),this.invoiceTotal=new h(0),this.checkoutLoading=o(!1),this.users=o([]),this.usersLoading=o(!1),this.getUsers()}calculateTotal(){let e=this.deliverInvoice.value;this.invoiceTotal.next(e.reduce((s,t)=>s+t.quantity*t.unit_price,0))}resetDeliverForm(){return{database_id:null,order_datetime:this.dateService.getCurrentDate(),total_price:0,notes:null}}checkout(e,s){this.checkoutLoading.set(!0),this.http.post(`${this.host}/deliver/invoice`,{order:e,items:s}).subscribe({next:t=>{this.notificationService.showSuccess(t.message,"home"),this.deliverInvoice.next([]),this.deliverForm.set(this.resetDeliverForm()),this.checkoutLoading.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.checkoutLoading.set(!1)}})}getUsers(){this.usersLoading.set(!0),this.http.get(`${this.host}/user-deliver/users`).subscribe({next:e=>{this.users.set(e),this.usersLoading.set(!1)},error:e=>{this.usersLoading.set(!1),this.notificationService.handleError(e.error,"users")}})}static{this.\u0275fac=function(s){return new(s||i)}}static{this.\u0275prov=n({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{L as a};
