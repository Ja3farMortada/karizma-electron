import{b as Ht,c as Ft}from"./chunk-POXK75SX.js";import{a as st,b as Vt}from"./chunk-TPLBFVKT.js";import{a as Ze}from"./chunk-4IS5N45W.js";import{a as se}from"./chunk-37XUPNQY.js";import{a as et}from"./chunk-6AMBXUQL.js";import{a as it,b as Dt}from"./chunk-EQKR7WYR.js";import{a as De}from"./chunk-6HTKW57C.js";import"./chunk-HT3JZ6CO.js";import{a as ot}from"./chunk-EERASPRL.js";import"./chunk-LHXBPRE2.js";import"./chunk-CK6XGA6X.js";import{a as ce}from"./chunk-AFRAGMDV.js";import{a as Pe}from"./chunk-THSNLICR.js";import{a as Ie}from"./chunk-5AMFDQWK.js";import"./chunk-MB5UDTNQ.js";import"./chunk-OWTGQR6U.js";import{a as nt,b as It}from"./chunk-IZUVX76I.js";import{a as de}from"./chunk-ALBPV6PR.js";import{a as ae,b as rt}from"./chunk-DVHYHQJ7.js";import{a as Pt,b as Mt}from"./chunk-GOLNOKOZ.js";import"./chunk-425U57QI.js";import"./chunk-7PIM7VCW.js";import{a as Ke}from"./chunk-GSMGX6RX.js";import{a as Tt,b as tt}from"./chunk-7LKCTRLS.js";import"./chunk-MEVQH5BX.js";import{A as Qe,B as Je,F as Xe,i as re,j as Ue,l as Ge,m as Et,p as B,q as Ye,v as N}from"./chunk-DNVA5LVB.js";import{b as J,c as A}from"./chunk-QLTZVGSE.js";import{$b as V,$c as wt,Ba as x,C as Se,Ca as d,D as ke,Da as p,Ec as me,F as He,Fc as k,G as y,Ga as Oe,Gc as Le,H as P,Hc as ne,I as Be,Ic as Ae,Ma as s,N as Ne,Na as g,Nb as _t,O as u,Oa as S,P as _,Qa as w,Ra as E,Sa as T,Sb as We,T as xe,Ua as vt,Va as I,Wa as le,Xa as we,Ya as Ct,_c as oe,a as K,aa as l,ba as $,cb as C,d as Me,db as b,dc as X,ha as j,hc as H,ic as Z,jc as pe,ka as f,kc as R,lc as Te,ma as c,mc as ee,ob as bt,oc as te,pa as Q,pc as ie,qb as Ee,qc as St,rc as je,sa as gt,sb as L,sc as qe,ta as ft,tc as xt,ua as yt,uc as F,v as Ve,va as n,vb as M,vc as ze,wa as o,xa as v,xb as $e,zb as Re}from"./chunk-E4UPHNBD.js";import{g as Fe}from"./chunk-WWX6BADO.js";var Rt=Fe(et());var Bt=(()=>{class i{constructor(e,r,t,a){this.apiService=e,this.http=r,this.notificationService=t,this.customersService=a,this.host=this.apiService.host,this.currentInvoice=j({}),this.signal_submited=j(!1),this.signal_submit_loading=j(!1),this.action_status$=new Me(""),this.selectedCustomerLatestItems=new Me([])}chcekout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/sell-orders`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getAccountTotalBalance(e.customer_id)}})}returnChcekout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getAccountTotalBalance(e.customer_id)}})}deleteInvoice(e,r){let t=e.order_id;console.log(t),this.signal_submited.set(!0),this.http.delete(`${this.host}/sell-orders/${t}`).subscribe({next:a=>{this.notificationService.showSuccess(a.message,"home")},error:a=>{this.notificationService.handleError(a.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getAccountTotalBalance(e.customer_id)}})}returnDeleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${t}`).subscribe({next:a=>{this.notificationService.showSuccess(a.message,"home")},error:a=>{this.notificationService.handleError(a.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getAccountTotalBalance(e.customer_id)}})}getCustomerLatestPurchase(e){this.http.get(`${this.apiService.host}/customers/${e}/purchases/latest`).subscribe({next:r=>{this.selectedCustomerLatestItems.next(r)}})}static{this.\u0275fac=function(r){return new(r||i)(He(A),He(Re),He(J),He(se))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var si=()=>({width:"95vw",height:"75vh"}),ht=()=>({standalone:!0}),ai=i=>({"ng-invalid ng-dirty":i}),Nt=i=>({invalid:i}),li=i=>({"text-red-500":i}),ci=(i,m)=>({"text-red-500":i,"text-orange-500":m});function pi(i,m){i&1&&(n(0,"small",31),s(1,"Customer is required."),o())}function mi(i,m){if(i&1){let e=x();n(0,"div",28)(1,"p-radioButton",32),T("ngModelChange",function(t){u(e);let a=p(3);return E(a.selected_price_type,t)||(a.selected_price_type=t),_(t)}),o(),n(2,"label",33),s(3),o()()}if(i&2){let e=m.$implicit,r=p(3);l(),c("value",e),w("ngModel",r.selected_price_type),c("ngModelOptions",I(6,ht))("inputId",e),l(),c("for",e),l(),S(" ",r.getPriceTypeLabel(e)," ")}}function di(i,m){if(i&1){let e=x();n(0,"div",6)(1,"div",18)(2,"div",19),v(3,"div",20),n(4,"label"),s(5,"Invoice Date"),o(),n(6,"p-calendar",21),T("ngModelChange",function(t){u(e);let a=p(2);return E(a.invoice_date,t)||(a.invoice_date=t),_(t)}),o()()(),n(7,"div",18)(8,"div",20)(9,"label",22),s(10,"Customer"),n(11,"span",23),s(12," *"),o()(),n(13,"p-dropdown",24),T("ngModelChange",function(t){u(e);let a=p(2);return E(a.customer_id,t)||(a.customer_id=t),_(t)}),d("onChange",function(t){u(e);let a=p(2);return _(a.customerChange(t.value))}),o(),f(14,pi,2,0,"small",25),o()(),n(15,"div",26)(16,"div",27)(17,"div",28)(18,"p-radioButton",29),T("ngModelChange",function(t){u(e);let a=p(2);return E(a.selected_price_type,t)||(a.selected_price_type=t),_(t)}),o(),n(19,"label",30),s(20),o()(),ft(21,mi,4,7,"div",28,gt),o()()()}if(i&2){let e=p(2);l(6),w("ngModel",e.invoice_date),c("ngModelOptions",I(16,ht))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0)("showSeconds",!0),l(7),w("ngModel",e.customer_id),c("options",e.customers)("filter",!0)("showClear",!0)("ngClass",le(17,ai,!e.customer_id)),l(),c("ngIf",!e.customer_id),l(4),w("ngModel",e.selected_price_type),c("ngModelOptions",I(19,ht)),l(2),S(" ",e.getPriceTypeLabel("latest")," "),l(),yt(e.priceTypes)}}function ui(i,m){if(i&1&&(n(0,"div",6)(1,"div",34)(2,"div",35),s(3," Total: "),o(),n(4,"div",36),s(5),C(6,"currency"),o()()()),i&2){let e=p(2);l(5),S(" ",b(6,1,e.invoiceTotal.total_dollar)," ")}}function _i(i,m){i&1&&(n(0,"tr")(1,"th",37),s(2,"#"),o(),n(3,"th",38),s(4,"Description"),o(),n(5,"th",37),s(6,"Cost"),o(),n(7,"th",37),s(8,"Qty"),o(),n(9,"th",39),s(10,"Unit"),o(),n(11,"th",39),s(12,"Total"),o(),n(13,"th",37),s(14,"Del?"),o()())}function hi(i,m){if(i&1){let e=x();n(0,"p-inputNumber",46),T("ngModelChange",function(t){u(e);let a=p().$implicit;return E(a.quantity,t)||(a.quantity=t),_(t)}),d("onFocus",function(t){u(e);let a=p(3);return _(a.select(t.target))})("ngModelChange",function(){u(e);let t=p().$implicit,a=p(2);return _(a.setQty(t))}),o()}if(i&2){let e=p().$implicit;w("ngModel",e.quantity)}}function gi(i,m){if(i&1&&(n(0,"span",47),s(1),o()),i&2){let e=p().$implicit;c("ngClass",le(2,li,!e.quantity)),l(),g(e.quantity)}}function fi(i,m){if(i&1){let e=x();n(0,"p-inputNumber",48),T("ngModelChange",function(t){u(e);let a=p().$implicit;return E(a.unit_price,t)||(a.unit_price=t),_(t)}),d("ngModelChange",function(){u(e);let t=p().$implicit,a=p(2);return _(a.setPrice(t))})("onFocus",function(t){u(e);let a=p(3);return _(a.select(t.target))}),o()}if(i&2){let e=p().$implicit;w("ngModel",e.unit_price),c("maxFractionDigits",2)("min",0)}}function yi(i,m){i&1&&v(0,"i",50)}function vi(i,m){if(i&1&&(n(0,"span",47),s(1),C(2,"currency"),n(3,"span"),f(4,yi,1,0,"i",49),o()()),i&2){let e=p().$implicit,r=p(2);c("ngClass",we(5,ci,!e.unit_price,r.getPriceWarining(e))),l(),g(b(2,3,e.unit_price)),l(3),c("ngIf",r.getPriceWarining(e))}}function Ci(i,m){if(i&1){let e=x();n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),C(7,"currency"),o(),n(8,"td",40)(9,"p-cellEditor"),f(10,hi,1,1,"ng-template",41)(11,gi,2,4,"ng-template",42),o()(),n(12,"td",43)(13,"p-cellEditor"),f(14,fi,1,3,"ng-template",41)(15,vi,5,8,"ng-template",42),o()(),n(16,"td"),s(17),C(18,"currency"),o(),n(19,"td",44),d("click",function(){let t=u(e).rowIndex,a=p(2);return _(a.removeRow(t))}),v(20,"i",45),o()()}if(i&2){let e=m.$implicit,r=m.rowIndex;l(2),g(r+1),l(2),g(e.product_name),l(2),g(b(7,8,e.unit_cost)),l(2),c("pEditableColumn",e.quantity)("ngClass",le(12,Nt,!e.quantity)),l(4),c("pEditableColumn",e.unit_price)("ngClass",le(14,Nt,!e.unit_price)),l(5),S(" ",b(18,10,e.unit_price*e.quantity)," ")}}function bi(i,m){if(i&1&&(n(0,"h4",52),s(1),o()),i&2){let e=p(3);l(),S(" Total units: ",e.invoiceTotal.total_qty," ")}}function Si(i,m){if(i&1&&f(0,bi,2,1,"h4",51),i&2){let e=p(2);c("ngIf",e.invoiceTotal.total_qty)}}function xi(i,m){i&1&&(n(0,"tr",53)(1,"td",54),s(2,"No data yet!"),o()())}function wi(i,m){if(i&1){let e=x();n(0,"div",6)(1,"div",7)(2,"p-card"),f(3,di,23,20,"ng-template",3),o()(),n(4,"div",8)(5,"p-card"),f(6,ui,7,3,"ng-template",3),o()()(),n(7,"p-card",9)(8,"div",6)(9,"div",10)(10,"p-table",11,0),f(12,_i,15,0,"ng-template",12)(13,Ci,21,16,"ng-template",3)(14,Si,1,1,"ng-template",13)(15,xi,3,0,"ng-template",14),o()(),n(16,"div",15)(17,"p-autoComplete",16,1),T("ngModelChange",function(t){u(e);let a=p();return E(a.search_product,t)||(a.search_product=t),_(t)}),d("completeMethod",function(t){u(e);let a=p();return _(a.searchItem(t))})("onKeyUp",function(t){u(e);let a=p();return _(a.submitInvoiceInput(t))}),o(),n(19,"button",17),d("click",function(){u(e);let t=p();return _(t.openProductsDialog())}),o()()()()}if(i&2){let e=p();l(10),Oe("scrollHeight",e.vh),c("value",e.order_items)("scrollable",!0),l(7),w("ngModel",e.search_product),c("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function Ei(i,m){if(i&1){let e=x();n(0,"p-button",55),d("onClick",function(){u(e);let t=p();return _(t.deleteInvoice())}),o(),n(1,"p-button",56),d("onClick",function(){u(e);let t=p();return _(t.closeEditDialog())}),o(),n(2,"p-button",57),d("onClick",function(){u(e);let t=p();return _(t.submitEditInvoice())}),o()}if(i&2){let e=p();c("disabled",e.submitted()),l(),c("disabled",e.submitted()),l(),c("loading",e.submitted())("disabled",e.order_items.length==0)}}var ct=(()=>{class i{constructor(e,r,t,a){this.editInvoiceService=e,this.authService=r,this.confirmationService=t,this.notificationsService=a,this.visible=!1,this.customers=[],this.return_invoice_edit=!1,this.onSubmit=new xe,this.onHide=new xe,this.stockService=this.authService.isAdmin()?y(Pe):y(Ie),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new st,this.order_items=[],this.customer_id=0,this.invoice_number="123",this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new K,this.products=this.stockService.getProducts(),this.matching_products=[],this.priceTypes=Object.keys(Vt),this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.editInvoiceService.selectedCustomerLatestItems.subscribe(e=>{this.selectedCustomerLatestItems=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.invoice.order_datetime,this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.order_items=structuredClone(this.invoice.items),this.customer_id=this.invoice.customer_id,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_amount,this.calculateTotal(),this.customerChange(this.invoice.customer_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal()}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal()}validateItems(){return this.order_items.find(r=>!r.unit_price||!r.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let r=this.order_items.find(t=>t.product_id===e.product_id);if(r)r.quantity+=1,this.calculateTotal();else{let t=0;if(this.selected_price_type==="latest"){let a=this.selectedCustomerLatestItems.find(h=>h.product_id===e.product_id);a&&(console.log("expected",a),t=a.unit_price)}else t=e[this.selected_price_type]||0;this.order_items.push({product_id:e.product_id,product_name:e.product_name,unit_price:t,price_type:this.selected_price_type,stock:e.quantity,quantity:1,unit_cost:e.unit_cost_usd,avg_cost:e.avg_cost_usd}),this.calculateTotal()}}submitInvoiceInput(e){e.key==="Enter"&&(typeof this.search_product=="object"&&this.search_product!==null?this.addProduct(this.search_product):this.search_product&&this.notificationsService.showError("Product not found","home"),this.search_product=null)}calculateTotal(){let e=new st,r=this.order_items;return r.length>0&&(r.forEach(t=>{e.total_qty+=t.quantity,e.cost_dollar+=t.unit_cost*t.quantity,e.subtotal_dollar+=t.unit_price*t.quantity}),e.total_dollar=e.subtotal_dollar-e.discount_dollar),this.invoiceTotal=e,e}submitEditInvoice(){let e=this.validateItems();this.customer_id&&!e?this.return_invoice_edit?this.editInvoiceService.returnChcekout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):e&&this.notificationsService.showError("Please enter price for all items","home")}searchItem(e){let r=this.products(),t=[],a=e.query;for(let h=0;h<r.length;h++){let q=r[h];q.product_name.toLowerCase().indexOf(a.toLowerCase())>-1&&t.push(q)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}customerChange(e){this.customer_id?this.editInvoiceService.getCustomerLatestPurchase(this.customer_id):this.selectedCustomerLatestItems=[]}removeRow(e){this.order_items.splice(e,1),this.calculateTotal()}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.order_items=[],this.submitted.set(!1),this.invoiceTotal=new st}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(r=>{this.addProduct(r)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(!e.unit_price)return!1;let r=e.unit_cost||0,t=e.unit_price;return typeof r=="string"&&(r=parseFloat(r)),typeof t=="string"&&(t=parseFloat(t)),t<r}static{this.\u0275fac=function(r){return new(r||i)($(Bt),$(ce),$(We),$(J))}}static{this.\u0275cmp=P({type:i,selectors:[["edit-invoice"]],inputs:{visible:"visible",invoice:"invoice",customers:"customers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ne],decls:4,vars:10,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","products","price"],[1,"grid"],[1,"col-12","md:col-9"],[1,"col-12","md:col-3"],["styleClass","mt-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime","showSeconds"],["for","customer"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","ngClass"],["class","p-error",4,"ngIf"],[1,"col-12","md:col-4","pb-0"],[1,"flex","flex-wrap","gap-3","justify-content-between","align-content-center","h-full"],[1,"flex","align-items-center"],["value","latest","inputId","latest",3,"ngModelChange","ngModel","ngModelOptions"],["for","latest",1,"ml-2"],[1,"p-error"],[3,"ngModelChange","value","ngModel","ngModelOptions","inputId"],[1,"ml-2",3,"for"],[1,"col-12","text-center"],[1,"text-green-500","text-900","font-medium","text-xl"],[1,"text-900","font-medium","text-xl"],["width","5%"],["width","40%"],["width","15%"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[3,"ngClass"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"onClick","disabled"],["label","Cancel Edit","icon","pi pi-times","size","small","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","disabled"],["label","Submit Edit","icon","pi pi-check","size","small","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading","disabled"]],template:function(r,t){r&1&&(n(0,"p-dialog",2),T("visibleChange",function(h){return E(t.visible,h)||(t.visible=h),h}),d("onHide",function(){return t.closeEditDialog()}),f(1,wi,20,7,"ng-template",3)(2,Ei,3,4,"ng-template",4),o(),n(3,"products-dialog",5),d("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(h){return t.assignSelectedProducts(h)}),o()),r&2&&(Q(I(9,si)),w("visible",t.visible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",t.productsDialogVisible)("products",t.products)("price",t.selected_price_type))},dependencies:[Ee,L,H,Te,ot,N,V,Qe,Je,me,k,F,oe,re,B,Ge,nt,Pt,M],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}"]})}}return i})();var Ii=()=>[10,25,50],Di=()=>({width:"95vw"});function Pi(i,m){i&1&&(n(0,"tr")(1,"th"),s(2,"Invoice #"),o(),n(3,"th"),s(4,"Customer"),o(),n(5,"th"),s(6,"Datetime"),o(),n(7,"th"),s(8,"total"),o(),n(9,"th",19),s(10,"Options"),o()())}function Mi(i,m){if(i&1){let e=x();n(0,"p-button",24),d("onClick",function(){u(e);let t=p().$implicit,a=p();return _(a.openEditDialog(t))}),o()}}function Vi(i,m){if(i&1){let e=x();n(0,"td")(1,"p-button",25),d("onClick",function(){u(e);let t=p().$implicit,a=p();return _(a.thermalPrint(t))}),o()()}}function Hi(i,m){if(i&1){let e=x();n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),o(),n(7,"td"),s(8),C(9,"currency"),o(),n(10,"td")(11,"button",20),d("click",function(){let t=u(e).$implicit,a=p();return _(a.showInvoiceDialog(t))}),o()(),n(12,"td"),f(13,Mi,1,0,"p-button",21),o(),f(14,Vi,2,0,"td",22),n(15,"td")(16,"p-button",23),d("onClick",function(){let t=u(e).$implicit,a=p();return _(a.sendWhatsapp(t))}),o()()()}if(i&2){let e,r=m.$implicit,t=p();l(2),g(r.invoice_number),l(2),g(r.customer_name),l(2),g(r.order_datetime),l(2),g(b(9,6,r.total_amount)),l(5),c("ngIf",((e=t.userPermissions())==null?null:e.edit_invoice)||!1),l(),c("ngIf",t.isWeb)}}function Fi(i,m){i&1&&(n(0,"tr")(1,"td",26),s(2,"No Records Found!"),o()())}function ki(i,m){i&1&&(n(0,"tr")(1,"th",29),s(2,"Description"),o(),n(3,"th",30),s(4,"Unit Price"),o(),n(5,"th",31),s(6,"Qty"),o(),n(7,"th",30),s(8,"Total Price"),o()())}function Bi(i,m){if(i&1&&(n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),C(5,"currency"),o(),n(6,"td"),s(7),o(),n(8,"td"),s(9),C(10,"currency"),o()()),i&2){let e=m.$implicit;l(2),g(e.product_name),l(2),S(" ",b(5,4,e.unit_price)," "),l(3),g(e.quantity),l(2),S(" ",b(10,6,e.total_price)," ")}}function Ni(i,m){if(i&1&&(n(0,"tr"),v(1,"td")(2,"td"),n(3,"td"),s(4),o(),n(5,"td"),s(6),C(7,"currency"),o()()),i&2){let e=p(3);l(4),g(e.selectedInvoiceTotals.totalQty),l(2),S(" Total: ",b(7,2,e.selectedInvoiceTotals.totalPrice)," ")}}function Oi(i,m){if(i&1&&(n(0,"p-table",28),f(1,ki,9,0,"ng-template",12)(2,Bi,11,8,"ng-template",13)(3,Ni,8,4,"ng-template",17),o()),i&2){let e=p(2);c("value",e.invoiceItems)}}function $i(i,m){if(i&1&&f(0,Oi,4,1,"p-table",27),i&2){let e=p();c("ngIf",e.invoiceItems.length!=0)}}function Ri(i,m){if(i&1){let e=x();n(0,"button",32),d("click",function(){u(e);let t=p();return _(t.hideInvoiceDialog())}),o()}}var Wt=(()=>{class i{constructor(e,r,t){this.customerService=e,this.historyService=r,this.decimalService=t,this.api=y(A),this.authService=y(ce),this.userPermissions=this.authService.userPermissions,this.isWeb=!window.electron,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new K,this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.host=this.historyService.host,this.searchForm=new pe({invoice_number:new R(null),customer_id:new R(null),invoice_date:new R(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Rt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchSalesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchSalesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(e){}printDelivery(e){}openEditDialog(e){console.log(e),this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchSalesHistory(this.searchForm.value)}sendWhatsapp(e){let r=e,t=r.customer_name,q=`961${r.customer_phone.replace(/\s+/g,"").replace(/^0/,"")}`,ue=r.items.map((D,G)=>`\u2022 ${D.product_name} -> ${D.quantity}\xD7$${D.unit_price} = $${D.total_price}`).join(`
`);this.api.get(`/customers/${e.customer_id}/balance`).subscribe({next:D=>{console.log(D);let G=D.balance,U=`
Invoice #${r.invoice_number}
Date:${r.order_datetime}
Customer:${t}

${ue}

Total: $${r.total_amount}

Remaining Balance: $${G}`,W=`https://wa.me/${q}?text=${encodeURIComponent(U.trim())}`;window.open(W,"_blank")}})}thermalPrint(e){let r=e,t=r.customer_name,a=32,h=(D,G)=>{let U=D.split(" "),W=[],O="";for(let Y of U)(O+Y).length>G?(W.push(O.trim()),O=Y+" "):O+=Y+" ";return O.trim().length>0&&W.push(O.trim()),W},q=D=>{let G=D.product_name.trim(),U=D.quantity,W=`$${D.total_price}`,O=a-10,Y=h(G,O),be="";return Y.forEach((ut,Zt)=>{if(Zt===0){let ei=a-(ut.length+`${U}x${W}`.length),ti=" ".repeat(Math.max(ei,1));be+=`${ut}${ti}${U}x${W}
`}else be+=`${ut}
`}),be+=`
`,be},ue=r.items.map(q).join("");this.api.get(`/customers/${e.customer_id}/balance`).subscribe({next:D=>{let G=D.balance,W=`${(Y=>{let be=Math.floor((a-Y.length)/2);return" ".repeat(Math.max(be,0))+Y})("*** Invoice ***")}



${"INVOICE #: "+r.invoice_number}
Customer: ${t}
Date: ${r.order_datetime}
-------------------------------
${ue}
-------------------------------
Total:      $${r.total_amount}

Remaining:  $${G}
-------------------------------`,O="rawbt:"+encodeURIComponent(W);window.location.href=O}})}static{this.\u0275fac=function(r){return new(r||i)($(se),$(de),$(De))}}static{this.\u0275cmp=P({type:i,selectors:[["app-sell-history"]],decls:23,vars:29,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers"],["colspan","4","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-info",3,"click"],["size","small","icon","pi pi-file-edit","severity","warning",3,"onClick",4,"ngIf"],[4,"ngIf"],["size","small","icon","pi pi-whatsapp","severity","success",3,"onClick"],["size","small","icon","pi pi-file-edit","severity","warning",3,"onClick"],["size","small","severity","contrast","icon","pi pi-print",3,"onClick"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),v(7,"input",6),o(),n(8,"div",5),v(9,"p-dropdown",7),o(),n(10,"div",5),v(11,"p-calendar",8),o(),n(12,"div",5),v(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),f(16,Pi,11,0,"ng-template",12)(17,Hi,17,8,"ng-template",13)(18,Fi,3,0,"ng-template",14),o()()()(),n(19,"p-dialog",15),T("visibleChange",function(h){return E(t.detailsDialogVisible,h)||(t.detailsDialogVisible=h),h}),d("onHide",function(){return t.hideInvoiceDialog()}),f(20,$i,1,1,"ng-template",16)(21,Ri,1,0,"ng-template",17),o(),n(22,"edit-invoice",18),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(h){return t.submitEdit(h)}),o()),r&2&&(l(3),c("toggleable",!0),l(),c("formGroup",t.searchForm),l(5),c("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(2),c("loading",t.loading()),l(),c("disabled",t.loading()),l(),c("value",t.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(27,Ii))("alwaysShowPaginator",!1)("loading",t.loading()),l(4),Q(I(28,Di)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers()))},dependencies:[L,ee,X,H,Z,te,ie,N,V,me,k,F,oe,ne,re,B,ae,ct,M]})}}return i})();var jt=Fe(et());var Wi=()=>[10,25,50];function ji(i,m){i&1&&(n(0,"tr")(1,"th"),s(2,"Payment #"),o(),n(3,"th"),s(4,"Customer"),o(),n(5,"th"),s(6,"Datetime"),o(),n(7,"th"),s(8,"total"),o(),n(9,"th",16),s(10,"Options"),o()())}function qi(i,m){if(i&1){let e=x();n(0,"p-button",20),d("onClick",function(){u(e);let t=p().$implicit,a=p();return _(a.thermalPrint(t))}),o()}}function zi(i,m){if(i&1){let e=x();n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),o(),n(7,"td"),s(8),C(9,"currency"),o(),n(10,"td")(11,"p-button",17),d("onClick",function(){let t=u(e).$implicit,a=p();return _(a.openEditDialog(t))}),o()(),n(12,"td"),f(13,qi,1,0,"p-button",18),o(),n(14,"td")(15,"p-button",19),d("onClick",function(){let t=u(e).$implicit,a=p();return _(a.sendWhatsapp(t))}),o()()()}if(i&2){let e=m.$implicit,r=p();l(2),g(e.journal_number),l(2),g(e.partner_name),l(2),g(e.payment_date),l(2),g(b(9,5,e.total_value)),l(5),c("ngIf",r.isWeb)}}function Li(i,m){i&1&&(n(0,"tr")(1,"td",21),s(2,"No Records Found!"),o()())}var qt=(()=>{class i{constructor(){this.api=y(A),this.customerService=y(se),this.historyService=y(de),this.isWeb=!window.electron,this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new pe({payment_date:new R(null),partner_id:new R(null),payment_number:new R(null)}),this.submitSearch()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=(0,jt.default)(this.searchForm.value.payment_date).format("YYYY-MM-DD")),this.historyService.fetchPaymentHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}openEditDialog(e){console.log(e),this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){this.historyService.fetchPaymentHistory(this.searchForm.value)}onUpdatePayment(e){let r=this.paymentsHistory().findIndex(t=>t.journal_id===e.journal_id);this.paymentsHistory.update(t=>[...t.slice(0,r),e,...t.slice(r+1)]),this.editDialogVisible=!1}onDeletePayment(e){this.paymentsHistory.update(r=>{let t=this.paymentsHistory().findIndex(a=>a.journal_id===e.journal_id);return r.splice(t,1),[...r]}),this.editDialogVisible=!1}thermalPrint(e){let r=e.amount||0;console.log(e.customer_id),this.api.get(`/customers/${e.customer_id}/balance`).subscribe({next:t=>{console.log(t);let a=t.balance,h=e.customer_name,q=e.journal_number,ue=e.payment_date,D=32,U=`${(O=>{let Y=Math.floor((D-O.length)/2);return" ".repeat(Math.max(Y,0))+O})("*** PAYMENT RECEIPT ***")}



Receipt #: ${q}
Customer: ${h}
Date: ${ue}
-------------------------------
Payment Amount:  $${r}
Remaining: $${a}
-------------------------------`,W="rawbt:"+encodeURIComponent(U.trim());window.location.href=W}})}sendWhatsapp(e){let r=e.amount;this.api.get(`/customers/${e.customer_id}/balance`).subscribe({next:t=>{console.log(t);let a=t.balance,h=e.customer_name,q=e.customer_phone,ue=e.journal_number,D=e.payment_date,U=`961${q.replace(/\s+/g,"").replace(/^0/,"")}`,W=`
            Payment #: ${ue}
            Customer: ${h}
            Date: ${D}

            Payment Amount: $${r}
            Remaining: $${a}`,O=`https://wa.me/${U}?text=${encodeURIComponent(W.trim())}`;window.open(O,"_blank")}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=P({type:i,selectors:[["app-payment-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"visibleChange","onUpdate","onDelete","visible","payment","mode"],["colspan","3","width","10%"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["icon","pi pi-print","severity","contrast","size","small",3,"onClick",4,"ngIf"],["icon","pi pi-whatsapp","severity","success","size","small",3,"onClick"],["icon","pi pi-print","severity","contrast","size","small",3,"onClick"],["colspan","11"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),v(7,"p-dropdown",6),o(),n(8,"div",5),v(9,"p-calendar",7),o(),n(10,"div",5),v(11,"input",8),o(),n(12,"div",5),v(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),f(16,ji,11,0,"ng-template",12)(17,zi,16,7,"ng-template",13)(18,Li,3,0,"ng-template",14),o()()()(),n(19,"payment-dialog",15),T("visibleChange",function(h){return E(t.editDialogVisible,h)||(t.editDialogVisible=h),h}),d("onUpdate",function(h){return t.onUpdatePayment(h)})("onDelete",function(h){return t.onDeletePayment(h)}),o()),r&2&&(l(3),c("toggleable",!0),l(),c("formGroup",t.searchForm),l(3),c("options",t.customers())("loading",t.customersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(4),c("loading",t.loading()),l(),c("disabled",t.loading()),l(),c("value",t.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(22,Wi))("alwaysShowPaginator",!1)("loading",t.loading()),l(4),w("visible",t.editDialogVisible),c("payment",t.selectedPayment)("mode","edit"))},dependencies:[L,ee,X,H,Z,te,ie,N,V,k,F,ne,re,B,ae,Ze,M]})}}return i})();var zt=Fe(et());var Ai=()=>[10,25,50],Ui=()=>({width:"95vw"});function Gi(i,m){i&1&&(n(0,"tr")(1,"th"),s(2,"Invoice #"),o(),n(3,"th"),s(4,"Customer"),o(),n(5,"th"),s(6,"Datetime"),o(),n(7,"th"),s(8,"total"),o(),n(9,"th",19),s(10,"Options"),o()())}function Yi(i,m){if(i&1){let e=x();n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),o(),n(7,"td"),s(8),C(9,"currency"),o(),n(10,"td")(11,"button",20),d("click",function(){let t=u(e).$implicit,a=p();return _(a.showInvoiceDialog(t))}),o()(),n(12,"td")(13,"button",21),d("click",function(){let t=u(e).$implicit,a=p();return _(a.printInvoice(t))}),o()(),n(14,"td")(15,"button",22),d("click",function(){let t=u(e).$implicit,a=p();return _(a.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;l(2),g(e.invoice_number),l(2),g(e.customer_name),l(2),g(e.order_date),l(2),g(b(9,4,e.total_amount))}}function Ki(i,m){i&1&&(n(0,"tr")(1,"td",23),s(2,"No Records Found!"),o()())}function Qi(i,m){i&1&&(n(0,"tr")(1,"th",26),s(2,"Description"),o(),n(3,"th",27),s(4,"Unit Price"),o(),n(5,"th",28),s(6,"Qty"),o(),n(7,"th",27),s(8,"Total Price"),o()())}function Ji(i,m){if(i&1&&(n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),C(5,"currency"),o(),n(6,"td"),s(7),o(),n(8,"td"),s(9),C(10,"currency"),o()()),i&2){let e=m.$implicit;l(2),g(e.product_name),l(2),S(" ",b(5,4,e.unit_price)," "),l(3),g(e.quantity),l(2),S(" ",b(10,6,e.total_price)," ")}}function Xi(i,m){if(i&1&&(n(0,"tr"),v(1,"td")(2,"td"),n(3,"td"),s(4),o(),n(5,"td"),s(6),C(7,"currency"),o()()),i&2){let e=p(3);l(4),g(e.selectedInvoiceTotals.totalQty),l(2),S(" Total: ",b(7,2,e.selectedInvoiceTotals.totalPrice)," ")}}function Zi(i,m){if(i&1&&(n(0,"p-table",25),f(1,Qi,9,0,"ng-template",12)(2,Ji,11,8,"ng-template",13)(3,Xi,8,4,"ng-template",17),o()),i&2){let e=p(2);c("value",e.invoiceItems)}}function en(i,m){if(i&1&&f(0,Zi,4,1,"p-table",24),i&2){let e=p();c("ngIf",e.invoiceItems.length!=0)}}function tn(i,m){if(i&1){let e=x();n(0,"button",29),d("click",function(){u(e);let t=p();return _(t.hideInvoiceDialog())}),o()}}var Lt=(()=>{class i{constructor(e,r,t){this.customerService=e,this.historyService=r,this.decimalService=t,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new K,this.returnHistory=this.historyService.returnHistory,this.loading=this.historyService.signal_loading,this.searchForm=new pe({invoice_number:new R(null),customer_id:new R(null),invoice_date:new R(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,zt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchReturnHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(e){}printDelivery(e){}openEditDialog(e){console.log(e),this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchReturnHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||i)($(se),$(de),$(De))}}static{this.\u0275cmp=P({type:i,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers","return_invoice_edit"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),v(7,"p-dropdown",6),o(),n(8,"div",5),v(9,"p-calendar",7),o(),n(10,"div",5),v(11,"input",8),o(),n(12,"div",5),v(13,"p-button",9),n(14,"p-button",10),d("onClick",function(){return t.resetSearch()}),o()()()()(),n(15,"p-table",11),f(16,Gi,11,0,"ng-template",12)(17,Yi,16,6,"ng-template",13)(18,Ki,3,0,"ng-template",14),o()()()(),n(19,"p-dialog",15),T("visibleChange",function(h){return E(t.detailsDialogVisible,h)||(t.detailsDialogVisible=h),h}),d("onHide",function(){return t.hideInvoiceDialog()}),f(20,en,1,1,"ng-template",16)(21,tn,1,0,"ng-template",17),o(),n(22,"edit-invoice",18),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(h){return t.submitEdit(h)}),o()),r&2&&(l(3),c("toggleable",!0),l(),c("formGroup",t.searchForm),l(3),c("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(4),c("loading",t.loading()),l(),c("disabled",t.loading()),l(),c("value",t.returnHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(28,Ai))("alwaysShowPaginator",!1)("loading",t.loading()),l(4),Q(I(29,Ui)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers())("return_invoice_edit",!0))},dependencies:[L,ee,X,H,Z,te,ie,N,V,me,k,F,oe,ne,re,B,ae,ct,M]})}}return i})();var Gt=Fe(et());var At=(()=>{class i{constructor(){this.api=y(A),this.notification=y(J),this.signal_submited=j(!1),this.signal_submit_loading=j(!1),this.action_status$=new Me("")}updateDispose(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.api.put(`dispose/${e.dispose_id}`,e).pipe(Ve(()=>{this.signal_submited.set(!1),this.signal_submit_loading.set(!1)})).subscribe({next:t=>{this.notification.showSuccess("Dispose order updated"),r.getItems(),this.action_status$.next("UPDATE")}})}deleteDispose(e,r){let t=e.dispose_id;this.signal_submited.set(!0),this.api.delete(`dispose/${t}`).pipe(Ve(()=>{this.signal_submited.set(!1),this.signal_submit_loading.set(!1)})).subscribe({next:a=>{this.notification.showSuccess("Dispose order deleted"),r.getItems(),this.action_status$.next("DELETE")}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var nn=()=>({width:"95vw",height:"75vh"}),on=()=>({standalone:!0}),rn=i=>({invalid:i}),sn=i=>({"text-red-500":i});function an(i,m){if(i&1){let e=x();n(0,"div",5)(1,"div",16)(2,"div",17),v(3,"div",18),n(4,"label"),s(5,"Dispose Date"),o(),n(6,"p-calendar",19),T("ngModelChange",function(t){u(e);let a=p(2);return E(a.dispose_date,t)||(a.dispose_date=t),_(t)}),o()()()()}if(i&2){let e=p(2);l(6),w("ngModel",e.dispose_date),c("ngModelOptions",I(7,on))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0)("showSeconds",!0)}}function ln(i,m){if(i&1&&(n(0,"div",5)(1,"div",20)(2,"div",21),s(3," Total Cost: "),o(),n(4,"div",22),s(5),C(6,"currency"),o()()()),i&2){let e=p(2);l(5),S(" ",b(6,1,e.disposeTotal.total_cost)," ")}}function cn(i,m){i&1&&(n(0,"tr")(1,"th",23),s(2,"#"),o(),n(3,"th",24),s(4,"Product"),o(),n(5,"th",25),s(6,"SKU"),o(),n(7,"th",26),s(8,"Unit Cost"),o(),n(9,"th",26),s(10,"Qty"),o(),n(11,"th",25),s(12,"Total Cost"),o(),n(13,"th",23),s(14,"Del?"),o()())}function pn(i,m){if(i&1){let e=x();n(0,"p-inputNumber",32),T("ngModelChange",function(t){u(e);let a=p().$implicit;return E(a.quantity,t)||(a.quantity=t),_(t)}),d("onFocus",function(t){u(e);let a=p(3);return _(a.select(t.target))})("ngModelChange",function(){u(e);let t=p().$implicit,a=p(2);return _(a.setQty(t))}),o()}if(i&2){let e=p().$implicit;w("ngModel",e.quantity)}}function mn(i,m){if(i&1&&(n(0,"span",33),s(1),o()),i&2){let e=p().$implicit;c("ngClass",le(2,sn,!e.quantity)),l(),g(e.quantity)}}function dn(i,m){if(i&1){let e=x();n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),o(),n(7,"td"),s(8),C(9,"currency"),o(),n(10,"td",27)(11,"p-cellEditor"),f(12,pn,1,1,"ng-template",28)(13,mn,2,4,"ng-template",29),o()(),n(14,"td"),s(15),C(16,"currency"),o(),n(17,"td",30),d("click",function(){let t=u(e).rowIndex,a=p(2);return _(a.removeRow(t))}),v(18,"i",31),o()()}if(i&2){let e=m.$implicit,r=m.rowIndex;l(2),g(r+1),l(2),g(e.product_name),l(2),g(e.sku||"---"),l(2),g(b(9,7,e.unit_cost)),l(2),c("pEditableColumn",e.quantity)("ngClass",le(11,rn,!e.quantity)),l(5),S(" ",b(16,9,e.unit_cost*e.quantity)," ")}}function un(i,m){if(i&1&&(n(0,"h4",35),s(1),o()),i&2){let e=p(3);l(),S(" Total units: ",e.disposeTotal.total_count," ")}}function _n(i,m){if(i&1&&f(0,un,2,1,"h4",34),i&2){let e=p(2);c("ngIf",e.disposeTotal.total_count)}}function hn(i,m){i&1&&(n(0,"tr",36)(1,"td",37),s(2,"No items yet!"),o()())}function gn(i,m){if(i&1){let e=x();n(0,"div",5)(1,"div",6)(2,"p-card"),f(3,an,7,8,"ng-template",3),o()(),n(4,"div",7)(5,"p-card"),f(6,ln,7,3,"ng-template",3),o()()(),n(7,"p-card",8)(8,"div",5)(9,"div",9)(10,"p-table",10,0),f(12,cn,15,0,"ng-template",11)(13,dn,19,13,"ng-template",3)(14,_n,1,1,"ng-template",12)(15,hn,3,0,"ng-template",13),o()(),n(16,"div",14)(17,"p-autoComplete",15,1),T("ngModelChange",function(t){u(e);let a=p();return E(a.search_product,t)||(a.search_product=t),_(t)}),d("completeMethod",function(t){u(e);let a=p();return _(a.searchItem(t))})("onKeyUp",function(t){u(e);let a=p();return _(a.submitDisposeInput(t))}),o()()()()}if(i&2){let e=p();l(10),Oe("scrollHeight",e.vh),c("value",e.order_items)("scrollable",!0),l(7),w("ngModel",e.search_product),c("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function fn(i,m){if(i&1){let e=x();n(0,"p-button",38),d("onClick",function(){u(e);let t=p();return _(t.deleteDispose())}),o(),n(1,"p-button",39),d("onClick",function(){u(e);let t=p();return _(t.closeEditDialog())}),o(),n(2,"p-button",40),d("onClick",function(){u(e);let t=p();return _(t.submitEditDispose())}),o()}if(i&2){let e=p();c("disabled",e.submitted()),l(),c("disabled",e.submitted()),l(),c("loading",e.submitted())("disabled",e.order_items.length==0)}}var Ut=(()=>{class i{constructor(){this.editDisposeService=y(At),this.authService=y(ce),this.confirmationService=y(We),this.notification=y(J),this.visible=!1,this.onSubmit=new xe,this.onHide=new xe,this.stockService=this.authService.isAdmin()?y(Pe):y(Ie),this.submitted=this.editDisposeService.signal_submited,this.form_error=!1,this.disposeTotal=new it,this.order_items=[],this.dispose_number="",this.subscriptions=new K,this.products=this.stockService.getProducts(),this.matching_products=[],this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editDisposeService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editDisposeService.action_status$.next(""),this.visible=!1)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.disposeOrder&&(this.dispose_date=this.disposeOrder.dispose_datetime,this.dispose_number=this.disposeOrder.invoice_number.substring(4,this.disposeOrder.invoice_number.length),this.order_items=structuredClone(this.disposeOrder.items).map(e=>({product_id:e.product_id,product_name:e.product_name,sku:e.sku||"",quantity:e.quantity,unit_cost:typeof e.unit_cost=="string"?parseFloat(e.unit_cost):e.unit_cost})),this.calculateTotal())}setQty(e){!e.quantity||e.quantity<=0?this.form_error=!0:this.validateItems(),this.calculateTotal()}validateItems(){return this.order_items.find(r=>!r.quantity||r.quantity<=0)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let r=this.order_items.find(t=>t.product_id===e.product_id);r?(r.quantity+=1,this.calculateTotal()):(this.order_items.push({product_id:e.product_id,product_name:e.product_name,sku:e.sku||"",quantity:1,unit_cost:e.unit_cost_usd||0}),this.calculateTotal())}submitDisposeInput(e){e.key==="Enter"&&(typeof this.search_product=="object"&&this.search_product!==null?this.addProduct(this.search_product):this.search_product&&this.notification.showError("Product not found","home"),this.search_product=null)}calculateTotal(){let e=new it,r=this.order_items;return r.length>0&&r.forEach(t=>{e.total_count+=t.quantity,e.total_cost+=t.unit_cost*t.quantity}),this.disposeTotal=e,e}submitEditDispose(){let e=this.validateItems();!e&&this.order_items.length>0?this.editDisposeService.updateDispose({dispose_id:this.disposeOrder.dispose_id,dispose_number:this.dispose_number,dispose_datetime:this.dispose_date,total_cost:this.disposeTotal.total_cost,total_count:this.disposeTotal.total_count,products_number:this.order_items.length,items:this.order_items},this.stockService):e?this.notification.showError("Please enter valid quantity for all items"):this.notification.showError("Please add at least one item")}searchItem(e){let r=this.products(),t=[],a=e.query;for(let h=0;h<r.length;h++){let q=r[h];q.product_name.toLowerCase().indexOf(a.toLowerCase())>-1&&t.push(q)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}removeRow(e){this.order_items.splice(e,1),this.calculateTotal()}clearDispose(){this.confirmationService.confirm({key:"home",message:"Are you sure that you want to clear dispose order?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.order_items=[],this.submitted.set(!1),this.disposeTotal=new it}})}deleteDispose(){this.confirmationService.confirm({key:"home",message:"Are you sure that you want to delete this dispose order?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.editDisposeService.deleteDispose(this.disposeOrder,this.stockService)}})}select(e){e.select()}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=P({type:i,selectors:[["edit-dispose"]],inputs:{visible:"visible",disposeOrder:"disposeOrder"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ne],decls:3,vars:7,consts:[["disposeTable",""],["searchInput",""],["header","Edit Dispose Order","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[1,"grid"],[1,"col-12","md:col-9"],[1,"col-12","md:col-3"],["styleClass","mt-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","searchInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],[1,"col-12","md:col-6","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","dispose_datetime","name","dispose_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime","showSeconds"],[1,"col-12","text-center"],[1,"text-red-500","text-900","font-medium","text-xl"],[1,"text-900","font-medium","text-xl"],["width","5%"],["width","40%"],["width","15%"],["width","10%"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["min","1","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[3,"ngClass"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","7"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"onClick","disabled"],["label","Cancel Edit","icon","pi pi-times","size","small","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","disabled"],["label","Submit Edit","icon","pi pi-check","size","small","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading","disabled"]],template:function(r,t){r&1&&(n(0,"p-dialog",2),T("visibleChange",function(h){return E(t.visible,h)||(t.visible=h),h}),d("onHide",function(){return t.closeEditDialog()}),f(1,gn,19,7,"ng-template",3)(2,fn,3,4,"ng-template",4),o()),r&2&&(Q(I(6,nn)),w("visible",t.visible),c("modal",!0)("closable",!0)("maximizable",!0))},dependencies:[Ee,L,H,Te,N,V,Qe,Je,k,F,oe,B,Ge,nt,M],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}.danger-hover[_ngcontent-%COMP%]{cursor:pointer;transition:color .2s}.danger-hover[_ngcontent-%COMP%]:hover{color:var(--red-500)}"]})}}return i})();var vn=()=>[10,25,50],Cn=()=>({width:"95vw"});function bn(i,m){i&1&&(n(0,"tr")(1,"th"),s(2,"Action #"),o(),n(3,"th"),s(4,"Datetime"),o(),n(5,"th"),s(6,"Total Cost"),o(),n(7,"th",18),s(8,"Products"),o(),n(9,"th",18),s(10,"Total Qty"),o(),n(11,"th",19),s(12,"Options"),o()())}function Sn(i,m){if(i&1){let e=x();n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),C(7,"currency"),o(),n(8,"td",18),s(9),o(),n(10,"td",18),s(11),o(),n(12,"td")(13,"button",20),d("click",function(){let t=u(e).$implicit,a=p();return _(a.showInvoiceDialog(t))}),o()(),n(14,"td")(15,"button",21),d("click",function(){let t=u(e).$implicit,a=p();return _(a.printInvoice(t))}),o()(),n(16,"td")(17,"button",22),d("click",function(){let t=u(e).$implicit,a=p();return _(a.openEditDialog(t))}),o()()()}if(i&2){let e=m.$implicit;l(2),g(e.invoice_number),l(2),g(e.dispose_date),l(2),g(b(7,5,e.total_cost)),l(3),S(" ",e.products_number," "),l(2),S(" ",e.total_count," ")}}function xn(i,m){i&1&&(n(0,"tr")(1,"td",23),s(2,"No Records Found!"),o()())}function wn(i,m){i&1&&(n(0,"tr")(1,"th",26),s(2,"Description"),o(),n(3,"th",27),s(4,"Qty"),o(),n(5,"th",27),s(6,"Cost"),o(),n(7,"th",28),s(8,"Total"),o()())}function En(i,m){if(i&1&&(n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),C(7,"currency"),o(),n(8,"td"),s(9),C(10,"currency"),o()()),i&2){let e=m.$implicit;l(2),g(e.product_name),l(2),g(e.quantity),l(2),g(b(7,4,e.unit_cost)),l(3),S(" ",b(10,6,e.unit_cost*e.quantity)," ")}}function Tn(i,m){if(i&1&&(n(0,"tr"),v(1,"td"),n(2,"td"),s(3),o(),v(4,"td"),n(5,"td"),s(6),C(7,"currency"),o()()),i&2){let e=p(3);l(3),S(" ",e.selectedDispose.total_count," "),l(3),S(" Total: ",b(7,2,e.selectedDispose.total_cost)," ")}}function In(i,m){if(i&1&&(n(0,"p-table",25),f(1,wn,9,0,"ng-template",11)(2,En,11,8,"ng-template",12)(3,Tn,8,4,"ng-template",16),o()),i&2){let e=p(2);c("value",e.disposeItems)}}function Dn(i,m){if(i&1&&f(0,In,4,1,"p-table",24),i&2){let e=p();c("ngIf",e.disposeItems.length!=0)}}function Pn(i,m){if(i&1){let e=x();n(0,"button",29),d("click",function(){u(e);let t=p();return _(t.hideInvoiceDialog())}),o()}}var Yt=(()=>{class i{constructor(e){this.historyService=e,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new K,this.disposeHistory=this.historyService.disposeHistory,this.loading=this.historyService.signal_loading,this.searchForm=new pe({invoice_number:new R(null),dispose_date:new R(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.dispose_date&&(this.searchForm.value.dispose_date=(0,Gt.default)(this.searchForm.value.dispose_date).format("YYYY-MM-DD")),this.historyService.fetchDisposeHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchDisposeHistory(null)}showInvoiceDialog(e){this.selectedDispose=e,this.disposeItems=e.items,this.detailsDialogVisible=!0}printInvoice(e){}printDelivery(e){}openEditDialog(e){this.selectedDispose=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedDispose=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1}submitEdit(e){this.editDialogVisible=!1,this.historyService.fetchDisposeHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||i)($(de))}}static{this.\u0275cmp=P({type:i,selectors:[["app-dispose-history"]],decls:21,vars:24,consts:[[1,"grid","m-1"],[1,"col-12","md:col-8","md:col-offset-2"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","dispose_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Action #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","disposeOrder"],[1,"extra-td"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","product_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","product_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","10%"],["width","20%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),v(7,"p-calendar",6),o(),n(8,"div",5),v(9,"input",7),o(),n(10,"div",5),v(11,"p-button",8),n(12,"p-button",9),d("onClick",function(){return t.resetSearch()}),o()()()()(),n(13,"p-table",10),f(14,bn,13,0,"ng-template",11)(15,Sn,18,7,"ng-template",12)(16,xn,3,0,"ng-template",13),o()()()(),n(17,"p-dialog",14),T("visibleChange",function(h){return E(t.detailsDialogVisible,h)||(t.detailsDialogVisible=h),h}),d("onHide",function(){return t.hideInvoiceDialog()}),f(18,Dn,1,1,"ng-template",15)(19,Pn,1,0,"ng-template",16),o(),n(20,"edit-dispose",17),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(h){return t.submitEdit(h)}),o()),r&2&&(l(3),c("toggleable",!0),l(),c("formGroup",t.searchForm),l(3),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(4),c("loading",t.loading()),l(),c("disabled",t.loading()),l(),c("value",t.disposeHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(22,vn))("alwaysShowPaginator",!1)("loading",t.loading()),l(4),Q(I(23,Cn)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),l(3),c("visible",t.editDialogVisible)("disposeOrder",t.selectedDispose))},dependencies:[L,ee,X,H,Z,te,ie,N,V,me,k,F,oe,ne,B,ae,Ut,M],styles:[".extra-td[_ngcontent-%COMP%]{display:none}@media (min-width: 960px){.extra-td[_ngcontent-%COMP%]{display:table-cell}}"]})}}return i})();var Kt=(()=>{class i{constructor(){this.api=y(A),this.notificationService=y(J),this.http=y(Re),this.dateService=y(Ke),this.startDate=j(this.dateService.getStartOfMonth()),this.endDate=j(this.dateService.getCurrentDate()),this.loadingTransactions=j(!1),this.cashTransactions=j([])}startDateChanged(){this.startDate.set(this.dateService.formatDate(this.startDate(),"yyyy-MM-dd"))}getCashTransactions(e,r){this.loadingTransactions.set(!0),e=this.dateService.formatDate(e,"yyyy-MM-dd"),r=this.dateService.formatDate(r,"yyyy-MM-dd"),this.http.get(`${this.api.host}/balance/transactions/${e}&${r}`).subscribe({next:t=>{this.cashTransactions.set(t),this.loadingTransactions.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.loadingTransactions.set(!1)}})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Mn=(i,m)=>({"text-300":i,"text-green-600":m}),Vn=(i,m)=>({"text-300":i,"text-red-600":m}),Hn=(i,m,e)=>({"text-red-600":i,"text-green-600":m,"font-bold":e}),Fn=(i,m)=>({"text-red-600":i,"text-green-600":m});function kn(i,m){if(i&1){let e=x();n(0,"label",6),s(1,"Start Date"),o(),n(2,"p-calendar",7),T("ngModelChange",function(t){u(e);let a=p();return E(a.startDate,t)||(a.startDate=t),_(t)}),d("onSelect",function(){u(e);let t=p();return _(t.startDateChanged())}),o(),n(3,"label",8),s(4,"End Date"),o(),n(5,"p-calendar",7),T("ngModelChange",function(t){u(e);let a=p();return E(a.endDate,t)||(a.endDate=t),_(t)}),d("onSelect",function(){u(e);let t=p();return _(t.endDateChanged())}),o()}if(i&2){let e=p();l(2),w("ngModel",e.startDate),c("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input"),l(3),w("ngModel",e.endDate),c("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function Bn(i,m){if(i&1){let e=x();n(0,"p-button",9),d("onClick",function(){u(e);let t=p();return _(t.selectToday())}),o(),n(1,"p-button",10),d("onClick",function(){u(e);let t=p();return _(t.selectThisMonth())}),o(),n(2,"p-button",11),d("onClick",function(){u(e);let t=p();return _(t.selectThisYear())}),o()}i&2&&(c("size","small"),l(),c("size","small"),l(),c("size","small"))}function Nn(i,m){i&1&&(n(0,"tr")(1,"th",12),s(2,"Date"),o(),n(3,"th",12),s(4,"Transaction"),o(),n(5,"th",12),s(6,"Description"),o(),n(7,"th",12),s(8,"Notes"),o(),n(9,"th",12),s(10,"Debit"),o(),n(11,"th",12),s(12,"Credit"),o(),n(13,"th",13),s(14,"Balance"),o()())}function On(i,m){if(i&1&&(n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),o(),n(7,"td"),s(8),o(),n(9,"td",14),s(10),C(11,"currency"),o(),n(12,"td",14),s(13),C(14,"currency"),o(),n(15,"td",14),s(16),C(17,"currency"),o()()),i&2){let e=m.$implicit,r=m.rowIndex,t=p();l(2),S(" ",e.journal_date||"Before "+t.startDate()," "),l(2),g(e.journal_number||"---"),l(2),S(" ",e.journal_description||"---"," "),l(2),S(" ",e.notes||"---"," "),l(),c("ngClass",we(16,Mn,e.debit==0,e.debit!=0)),l(),S(" ",b(11,10,e.debit)," "),l(2),c("ngClass",we(19,Vn,e.credit==0,e.credit!=0)),l(),S(" ",b(14,12,e.credit)," "),l(2),c("ngClass",Ct(22,Hn,t.balances[r]<0,t.balances[r]>0,t.balances[r]==0)),l(),S(" ",b(17,14,t.balances[r])," ")}}function $n(i,m){if(i&1&&(n(0,"tr"),v(1,"td",15),n(2,"td"),s(3,"Balance Due"),o(),n(4,"td",16),s(5),C(6,"currency"),o(),n(7,"td",17),s(8),C(9,"currency"),o(),n(10,"td",14),s(11),C(12,"currency"),o()()),i&2){let e=p();l(5),S(" ",b(6,4,e.totalDebit)," "),l(3),S(" ",b(9,6,e.totalCredit)," "),l(2),c("ngClass",we(10,Fn,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),l(),S(" ",b(12,8,e.balances[e.balances.length-1])," ")}}var dt=(()=>{class i{constructor(){this.transactionService=y(Kt),this.fb=y(je),this.dateService=y(Ke),this.decimalService=y(De),this.loadingTransactions=this.transactionService.loadingTransactions,this.cashTransactions=this.transactionService.cashTransactions,this.startDate=this.transactionService.startDate,this.endDate=this.transactionService.endDate,this.balances=[],this.totalDebit=0,this.totalCredit=0,this.submitSearch(),bt(()=>{let e=this.cashTransactions();if(e.length>0){this.balances=[],this.balances[0]=parseFloat(e[0].balance);for(let r=1;r<e.length;r++)this.balances[r]=this.balances[r-1]+parseFloat(e[r].debit)-parseFloat(e[r].credit);this.calculateTotals(e)}else this.balances=[]})}submitSearch(){this.transactionService.getCashTransactions(this.startDate(),this.endDate())}startDateChanged(){this.transactionService.startDateChanged(),this.submitSearch()}endDateChanged(){this.submitSearch()}selectToday(){this.transactionService.startDate.set(this.dateService.getCurrentDate()),this.transactionService.endDate.set(this.dateService.getCurrentDate()),this.submitSearch()}selectThisMonth(){this.transactionService.startDate.set(this.dateService.getStartOfMonth()),this.transactionService.endDate.set(this.dateService.getEndOfMonth()),this.submitSearch()}selectThisYear(){this.transactionService.startDate.set(this.dateService.getStartOfYear()),this.transactionService.endDate.set(this.dateService.getEndOfYear()),this.submitSearch()}calculateTotals(e){this.totalDebit=0,this.totalCredit=0;for(let r=1;r<e.length;r++)this.totalDebit=this.decimalService.add(this.totalDebit,parseFloat(e[r].debit)),this.totalCredit=this.decimalService.add(this.totalCredit,parseFloat(e[r].credit))}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=P({type:i,selectors:[["cash-transactions"]],standalone:!0,features:[vt],decls:8,vars:2,consts:[["pTemplate","left"],["pTemplate","right"],["dataKey","account_number","styleClass","p-datatable-sm","scrollHeight","68vh",1,"ledger_table",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"mr-2"],["styleClass","p-inputtext-sm","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput","showButtonBar","required","iconDisplay"],[1,"ml-5","mr-2"],["label","Today","severity","secondary",3,"onClick","size"],["styleClass","mx-2","label","This Month","severity","secondary",3,"onClick","size"],["label","This Year","severity","secondary",3,"onClick","size"],["width","15%"],["width","10%"],[3,"ngClass"],["colspan","3"],[1,"text-green-600"],[1,"text-red-600"]],template:function(r,t){r&1&&(n(0,"p-card")(1,"p-toolbar"),f(2,kn,6,12,"ng-template",0)(3,Bn,3,3,"ng-template",1),o(),n(4,"p-table",2),f(5,Nn,15,0,"ng-template",3)(6,On,18,26,"ng-template",4)(7,$n,13,13,"ng-template",5),o()()),r&2&&(l(4),c("value",t.cashTransactions())("scrollable",!0))},dependencies:[ze,F,V,rt,Ae,Ye,B,k,Xe,N,Le,M,Ue,qe,H,St,Te,$e,Ee,tt,Tt]})}}return i})();var Qt=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=P({type:i,selectors:[["app-cash-history"]],decls:3,vars:0,consts:[[1,"grid","m-1"],[1,"col-12"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1),v(2,"cash-transactions"),o()())},dependencies:[dt]})}}return i})();var Wn=()=>[10,25,50];function jn(i,m){i&1&&(n(0,"tr")(1,"th",17),s(2,"Code"),o(),n(3,"th",18),s(4,"Product Name"),o(),n(5,"th",19),s(6,"Invoice #"),o(),n(7,"th",19),s(8,"Customer"),o(),n(9,"th",20),s(10,"Datetime"),o(),n(11,"th",19),s(12,"Unit Price"),o(),n(13,"th",21),s(14,"Qty"),o(),n(15,"th",19),s(16,"Total"),o()())}function qn(i,m){if(i&1&&(n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),s(6),o(),n(7,"td"),s(8),o(),n(9,"td"),s(10),o(),n(11,"td"),s(12),C(13,"currency"),o(),n(14,"td"),s(15),o(),n(16,"td"),s(17),C(18,"currency"),o()()),i&2){let e=m.$implicit;l(2),g(e.sku||"---"),l(2),g(e.product_name),l(2),g(e.invoice_number),l(2),g(e.customer_name),l(2),g(e.order_datetime),l(2),g(b(13,8,e.unit_price)),l(3),g(e.quantity),l(2),g(b(18,10,e.total_price))}}function zn(i,m){i&1&&(n(0,"tr")(1,"td",22),s(2,"No Records Found!"),o()())}var Jt=(()=>{class i{constructor(){this.fb=y(je),this.api=y(A),this.customersService=y(se),this.authService=y(ce),this.stockService=this.authService.isAdmin()?y(Pe):y(Ie),this.products=this.stockService.getProducts(),this.customers=this.customersService.customers,this.productsHistory=j([]),this.searchForm=this.fb.group({customer_id:[null],product_id:[null],invoice_number:[null],invoice_date:[null]}),this.loading=!1,this.fetchProductHistory()}fetchProductHistory(){this.loading=!0,this.api.post("history/products/search",this.searchForm.value).pipe(Ve(()=>{this.loading=!1})).subscribe(e=>{this.productsHistory.set(e)})}resetSearch(){this.searchForm.reset(),this.fetchProductHistory()}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=P({type:i,selectors:[["app-products-history"]],decls:21,vars:25,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","product_id","styleClass","p-inputtext-sm w-full","id","product","appendTo","body","optionLabel","product_name","optionValue","product_id","placeholder","Select Product","filterBy","product_name",3,"onChange","options","filter","showClear","autoOptionFocus","virtualScroll","virtualScrollItemSize"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"ngModelChange"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"onChange","options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"onChange","showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["width","12%"],["width","30%"],["width","10%"],["width","13%"],["width","5%"],["colspan","11"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.fetchProductHistory()}),n(5,"div",4)(6,"div",5)(7,"p-dropdown",6),d("onChange",function(){return t.fetchProductHistory()}),o()(),n(8,"div",7)(9,"input",8),d("ngModelChange",function(){return t.fetchProductHistory()}),o()(),n(10,"div",7)(11,"p-dropdown",9),d("onChange",function(){return t.fetchProductHistory()}),o()(),n(12,"div",7)(13,"p-calendar",10),d("onChange",function(){return t.fetchProductHistory()}),o()(),n(14,"div",5),v(15,"p-button",11),n(16,"p-button",12),d("onClick",function(){return t.resetSearch()}),o()()()()(),n(17,"p-table",13),f(18,jn,17,0,"ng-template",14)(19,qn,19,12,"ng-template",15)(20,zn,3,0,"ng-template",16),o()()()()),r&2&&(l(3),c("toggleable",!0),l(),c("formGroup",t.searchForm),l(3),c("options",t.products())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("virtualScroll",!0)("virtualScrollItemSize",38),l(4),c("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),l(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),l(2),c("loading",t.loading),l(),c("disabled",t.loading),l(),c("value",t.productsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(24,Wn))("alwaysShowPaginator",!1)("loading",t.loading))},dependencies:[ee,X,H,Z,te,ie,N,V,k,F,ne,re,B,ae,M]})}}return i})();var Ln=[{path:"sales-history",data:{breadcrumb:"sales"},component:Wt},{path:"products-history",data:{breadcrumb:"Products"},component:Jt},{path:"payment-history",data:{breadcrumb:"payments"},component:qt},{path:"return-history",data:{breadcrumb:"returns"},component:Lt},{path:"dispose-history",data:{breadcrumb:"dispose"},component:Yt},{path:"cash-history",data:{breadcrumb:"Cash"},component:Qt}],Xt=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=Be({type:i})}static{this.\u0275inj=ke({imports:[_t.forChild(Ln),_t]})}}return i})();var ys=(()=>{class i{static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275mod=Be({type:i})}static{this.\u0275inj=ke({imports:[$e,Xt,qe,xt,ot,Xe,Le,ze,wt,Ae,tt,Ue,Ye,rt,Ht,Et,Ft,It,Mt,Ze,Dt,dt]})}}return i})();export{ys as HistoryModule};
