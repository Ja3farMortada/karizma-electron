import{a as Pe}from"./chunk-YAMBQIRM.js";import{a as W}from"./chunk-5AMFDQWK.js";import"./chunk-MB5UDTNQ.js";import"./chunk-OWTGQR6U.js";import{a as Ue,b as Ve}from"./chunk-IZUVX76I.js";import{b as fe}from"./chunk-7PIM7VCW.js";import"./chunk-GSMGX6RX.js";import{a as Me,b as Ee}from"./chunk-7LKCTRLS.js";import"./chunk-MEVQH5BX.js";import{A as Se,B as De,C as Te,D as Ie,F as q,i as _e,j as ge,l as ve,m as he,p as Ce,q as be,v as L,w as ye,x as we,y as xe}from"./chunk-DNVA5LVB.js";import{b as oe}from"./chunk-QLTZVGSE.js";import{$b as F,$c as ue,Ba as h,Ca as _,D as E,Da as s,Ec as ce,Fc as O,G as S,Ga as X,Gc as R,H as U,Hc as me,I as V,Ia as Y,Ic as B,Ja as Z,Ka as $,La as H,Ma as a,Na as b,Nb as Q,O as p,Oa as D,P as c,Qa as y,Ra as w,Sa as x,Sb as ne,T as j,Ua as ee,Va as M,Wa as z,_c as de,a as A,aa as m,cb as T,db as I,hc as re,ka as f,lc as le,ma as d,pa as J,qb as te,sb as ie,sc as ae,uc as se,va as r,vb as P,vc as pe,wa as o,xa as C,xb as k,z as G}from"./chunk-E4UPHNBD.js";import"./chunk-WWX6BADO.js";var Le=["tableSearch"],qe=()=>({width:"75vw"}),Ne=()=>({"1199px":"85vw","575px":"95vw"}),je=()=>["product_name"],He=()=>[10,15,50,100];function ze(n,u){n&1&&(r(0,"tr")(1,"th",14),C(2,"p-tableHeaderCheckbox"),o(),r(3,"th",15),a(4," Description"),C(5,"p-sortIcon",16),o(),r(6,"th",17),a(7," Category"),C(8,"p-sortIcon",18),o(),r(9,"th"),a(10,"Price"),o()())}function Qe(n,u){if(n&1&&(r(0,"tr",19)(1,"td"),C(2,"p-tableCheckbox",20),o(),r(3,"td"),a(4),o(),r(5,"td"),a(6),o(),r(7,"td"),a(8),T(9,"currency"),o()()),n&2){let e=u.$implicit;d("pSelectableRow",e),m(2),d("pSelectableRow",e)("value",e),m(2),b(e.product_name),m(2),b(e.category_name||"---"),m(2),b(I(9,6,e.unit_cost_usd))}}function Ke(n,u){if(n&1){let e=h();r(0,"div",5)(1,"div",6)(2,"span",7),C(3,"i",8),r(4,"input",9,0),_("input",function(t){p(e);let l=H(10);return c(l.filterGlobal(t.target.value,"contains"))}),o()()(),r(6,"div",6)(7,"h3",10),a(8),o()()(),r(9,"p-table",11,1),x("selectionChange",function(t){p(e);let l=s();return w(l.selectedProducts,t)||(l.selectedProducts=t),c(t)}),_("onRowSelect",function(){p(e);let t=s();return c(t.selectInput())})("onRowUnselect",function(){p(e);let t=s();return c(t.selectInput())}),f(11,ze,11,0,"ng-template",12)(12,Qe,10,8,"ng-template",13),o()}if(n&2){let e=H(10),i=s();m(4),d("value",e.filters.global==null?null:e.filters.global.value),m(4),D(" Total Selected: ",i.selectedProducts.length," "),m(),d("value",i.products()),y("selection",i.selectedProducts),d("loading",i.tableLoading())("globalFilterFields",M(12,je))("filterDelay",0)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",M(13,He))("alwaysShowPaginator",!0)}}function Ae(n,u){if(n&1){let e=h();r(0,"h3",21),a(1),o(),r(2,"p-button",22),_("onClick",function(){p(e);let t=s();return c(t.closeDialog())}),o(),r(3,"p-button",23),_("onClick",function(){p(e);let t=s();return c(t.submitProducts())}),o()}if(n&2){let e=s();m(),D(" Total Selected: ",e.selectedProducts.length," "),m(2),d("disabled",e.selectedProducts.length==0)}}var N=(()=>{class n{constructor(){this.stockService=S(W),this.visible=!1,this.onSubmit=new j,this.onHide=new j,this.products=this.stockService.getProducts(),this.tableLoading=this.stockService.tableLoading,this.selectedProducts=[]}ngOnInit(){}submitProducts(){this.onSubmit.emit(this.selectedProducts),this.closeDialog()}closeDialog(){this.selectedProducts=[],this.onHide.emit(!1)}selectInput(){this.tableSearch.nativeElement.select()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=U({type:n,selectors:[["user-deliver-dialog"]],viewQuery:function(i,t){if(i&1&&Y(Le,5),i&2){let l;Z(l=$())&&(t.tableSearch=l.first)}},inputs:{visible:"visible"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},standalone:!0,features:[ee],decls:3,vars:10,consts:[["tableSearch",""],["dt",""],["header","Select Items","styleClass","p-fluid",3,"visibleChange","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"grid","mb-2"],[1,"col-6"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],[1,"text-center","m-0"],["selectionMode","multiple","dataKey","product_id","styleClass","p-datatable-sm","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records",3,"selectionChange","onRowSelect","onRowUnselect","value","selection","loading","globalFilterFields","filterDelay","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator"],["pTemplate","header"],["pTemplate","body"],[2,"width","4rem"],["pSortableColumn","product_name"],["field","product_name"],["pSortableColumn","category_name"],["field","category_name"],[3,"pSelectableRow"],[3,"pSelectableRow","value"],[1,"text-left","m-0"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Finish","icon","pi pi-check","severity","success","size","small",3,"onClick","disabled"]],template:function(i,t){i&1&&(r(0,"p-dialog",2),x("visibleChange",function(g){return w(t.visible,g)||(t.visible=g),g}),f(1,Ke,13,14,"ng-template",3)(2,Ae,4,2,"ng-template",4),o()),i&2&&(J(M(8,qe)),d("modal",!0),y("visible",t.visible),d("breakpoints",M(9,Ne))("closeOnEscape",!1)("closable",!1)("maximizable",!0))},dependencies:[q,L,F,ye,xe,we,Te,Ie,R,O,ue,de,k,P,B,me]})}}return n})();var Je=n=>({"ng-invalid ng-dirty":n}),Xe=n=>({invalid:n});function Ye(n,u){n&1&&(r(0,"small",25),a(1,"User is required."),o())}function Ze(n,u){n&1&&(r(0,"tr")(1,"th",26),a(2,"#"),o(),r(3,"th",27),a(4,"Description"),o(),r(5,"th",28),a(6,"Unit"),o(),r(7,"th",29),a(8,"Qty"),o(),r(9,"th",28),a(10,"Total"),o(),r(11,"th",26),a(12,"Del?"),o()())}function $e(n,u){if(n&1){let e=h();r(0,"p-inputNumber",35),x("ngModelChange",function(t){p(e);let l=s().$implicit;return w(l.quantity,t)||(l.quantity=t),c(t)}),_("onFocus",function(t){p(e);let l=s(2);return c(l.select(t.target))})("ngModelChange",function(){p(e);let t=s().$implicit,l=s();return c(l.setQty(t))}),o()}if(n&2){let e=s().$implicit;y("ngModel",e.quantity)}}function et(n,u){if(n&1&&a(0),n&2){let e=s().$implicit;D(" ",e.quantity," ")}}function tt(n,u){if(n&1){let e=h();r(0,"tr")(1,"td"),a(2),o(),r(3,"td"),a(4),o(),r(5,"td"),a(6),T(7,"currency"),o(),r(8,"td",30)(9,"p-cellEditor"),f(10,$e,1,1,"ng-template",31)(11,et,1,1,"ng-template",32),o()(),r(12,"td"),a(13),T(14,"currency"),o(),r(15,"td",33),_("click",function(){let t=p(e).rowIndex,l=s();return c(l.removeRow(t))}),C(16,"i",34),o()()}if(n&2){let e=u.$implicit,i=u.rowIndex;m(2),b(i+1),m(2),b(e.product_name),m(2),b(I(7,6,e.unit_price)),m(2),d("pEditableColumn",e.quantity)("ngClass",z(10,Xe,!e.quantity)),m(5),D(" ",I(14,8,e.unit_price*e.quantity)," ")}}function it(n,u){}function nt(n,u){n&1&&(r(0,"tr",36)(1,"td",37),a(2,"No data yet!"),o()())}function ot(n,u){if(n&1){let e=h();r(0,"p-autoComplete",38,1),x("ngModelChange",function(t){p(e);let l=s();return w(l.search_product,t)||(l.search_product=t),c(t)}),_("completeMethod",function(t){p(e);let l=s();return c(l.searchItem(t))})("onKeyUp",function(t){p(e);let l=s();return c(l.submitInvoiceInput(t))}),o(),r(2,"button",39),_("click",function(){p(e);let t=s();return c(t.openProductsDialog())}),o()}if(n&2){let e=s();y("ngModel",e.search_product),d("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function rt(n,u){if(n&1){let e=h();r(0,"p-button",40),_("onClick",function(){p(e);let t=s();return c(t.clearInvoice())}),o(),r(1,"p-button",41),_("onClick",function(){p(e);let t=s();return c(t.checkout())}),o()}if(n&2){let e=s();d("disabled",e.deliverInvoice.length===0||e.checkoutLoading()),m(),d("disabled",e.deliverInvoice.length===0||!e.deliverForm().database_id)("loading",e.checkoutLoading())}}var ke=(()=>{class n{constructor(){this.deliverService=S(Pe),this.stockService=S(W),this.notificationService=S(oe),this.confirmationService=S(ne),this.vh=75,this.dialogVisible=!1,this.products=this.stockService.products,this.users=this.deliverService.users,this.userInvalid=!1,this.checkoutLoading=this.deliverService.checkoutLoading,this.deliverForm=this.deliverService.deliverForm,this.search_product=null,this.matching_products=[],this.subscriptions=new A}ngOnInit(){this.subscriptions.add(this.deliverService.deliverInvoice.pipe(G(e=>{this.deliverService.calculateTotal()})).subscribe(e=>{this.deliverInvoice=e})),this.subscriptions.add(this.deliverService.invoiceTotal.subscribe(e=>{this.invoiceTotal=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}searchItem(e){let i=this.products(),t=[],l=e.query;for(let g=0;g<i.length;g++){let v=i[g];v.product_name.toLowerCase().indexOf(l.toLowerCase())>-1&&t.push(v)}this.matching_products=t}submitInvoiceInput(e){e.key==="Enter"&&(typeof this.search_product=="object"&&this.search_product!==null?this.addProduct(this.search_product):this.search_product&&this.notificationService.showError("Product not found","home"),this.search_product=null)}addProduct(e){let i=this.deliverInvoice.findIndex(t=>t.product_id===e.product_id);i!==-1?(this.deliverInvoice[i].quantity+=1,this.deliverService.deliverInvoice.next(this.deliverInvoice)):this.deliverService.deliverInvoice.next([...this.deliverInvoice,{product_id:e.product_id,product_name:e.product_name,quantity:1,unit_price:e.unit_cost_usd}])}openProductsDialog(){this.dialogVisible=!0}closeProductsDialog(){this.dialogVisible=!1}assignSelectedProducts(e){this.dialogVisible=!1,e.forEach(i=>{this.addProduct(i)})}validate(){this.userInvalid=!1}select(e){e.select()}setPrice(e){e.unit_price,this.deliverService.calculateTotal()}setQty(e){this.deliverService.calculateTotal()}removeRow(e){let i=this.deliverInvoice;this.deliverService.deliverInvoice.next([...i.slice(0,e),...i.slice(e+1)])}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.deliverService.deliverInvoice.next([]),this.deliverService.deliverForm.set(this.deliverService.resetDeliverForm())}})}checkout(){console.log(this.deliverService.deliverForm());let e=0;this.deliverInvoice.forEach(i=>{(i.unit_price==0||!i.unit_price)&&(this.notificationService.showError(`${i.product_name} cannot be 0.00$`,"home"),e++),(i.quantity==0||!i.quantity)&&(this.notificationService.showError(`${i.product_name} Quantity cannot be 0`,"home"),e++)}),e===0&&this.confirmationService.confirm({key:"home",message:'Are you sure that you want to continue"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.deliverForm().total_price=this.invoiceTotal,this.deliverService.checkout(this.deliverForm(),this.deliverInvoice)}})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=U({type:n,selectors:[["user-deliver"]],decls:36,vars:21,consts:[["invoiceTable",""],["barcodeInput",""],[1,"grid","m-1"],[1,"col-12","md:col-6"],["styleClass","p-0"],[1,"grid"],[1,"field"],[1,"flex","flex-column","gap-2"],["for","order_datetime"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small",3,"ngModelChange","ngModel","readonlyInput","iconDisplay","showIcon"],["for","user"],["styleClass","p-inputtext-sm w-full","id","user","appendTo","body","optionLabel","database_name","optionValue","database_id","placeholder","Select User","filterBy","database_name",1,"ng-invalid","ng-dirty",3,"ngModelChange","onChange","ngModel","options","filter","showClear","autoOptionFocus","ngClass"],["class","p-error",4,"ngIf"],[1,"text-center","mt-0","mb-0","lg:mt-4","lg:mb-4"],[1,"text-green-500"],[1,"col-12"],["dataKey","product_id_fk","styleClass","p-datatable-sm p-datatable-gridlines mt-3",3,"value","scrollable","scrollHeight","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["pTemplate","emptymessage"],["styleClass","mt-2 p-2"],["pTemplate","left"],["pTemplate","right"],[3,"onHide","onSubmit","visible"],[1,"p-error"],["width","5%"],["width","40%"],["width","20%"],["width","10%"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["min","1","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[1,"surface-300"],["colspan","6"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["label","Clear","icon","pi pi-times","size","small","severity","danger","styleClass","mr-2",3,"onClick","disabled"],["label","Checkout","icon","pi pi-cart-plus","size","small","severity","success",3,"onClick","disabled","loading"]],template:function(i,t){if(i&1){let l=h();r(0,"div",2)(1,"div",3)(2,"p-card",4)(3,"div",5)(4,"div",3)(5,"div",6)(6,"div",7)(7,"label",8),a(8,"Invoice Date"),o(),r(9,"p-calendar",9),x("ngModelChange",function(v){return p(l),w(t.deliverForm().order_datetime,v)||(t.deliverForm().order_datetime=v),c(v)}),o()()()(),r(10,"div",3)(11,"div",6)(12,"div",7)(13,"label",10),a(14,"User"),o(),r(15,"p-dropdown",11),x("ngModelChange",function(v){return p(l),w(t.deliverForm().database_id,v)||(t.deliverForm().database_id=v),c(v)}),_("onChange",function(){return p(l),c(t.validate())}),o(),f(16,Ye,2,0,"small",12),o()()()()()(),r(17,"div",3)(18,"p-card")(19,"h1",13)(20,"span",14),a(21,"Total: "),o(),a(22),T(23,"currency"),o()()(),r(24,"div",15)(25,"p-card")(26,"p-table",16,0),f(28,Ze,13,0,"ng-template",17)(29,tt,17,12,"ng-template",18)(30,it,0,0,"ng-template",19)(31,nt,3,0,"ng-template",20),o(),r(32,"p-toolbar",21),f(33,ot,3,4,"ng-template",22)(34,rt,2,3,"ng-template",23),o()()()(),r(35,"user-deliver-dialog",24),_("onHide",function(){return p(l),c(t.closeProductsDialog())})("onSubmit",function(v){return p(l),c(t.assignSelectedProducts(v))}),o()}i&2&&(m(9),y("ngModel",t.deliverForm().order_datetime),d("readonlyInput",!0)("iconDisplay","input")("showIcon",!0),m(6),y("ngModel",t.deliverForm().database_id),d("options",t.users())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("ngClass",z(19,Je,t.userInvalid)),m(),d("ngIf",t.userInvalid),m(6),D("",I(23,17,t.invoiceTotal)," "),m(4),X("scrollHeight",t.vh),d("value",t.deliverInvoice)("scrollable",!0)("loading",t.checkoutLoading()),m(9),d("visible",t.dialogVisible))},dependencies:[te,ie,re,le,N,se,F,ce,O,L,Se,De,Ce,_e,Me,Ue,ve,P],styles:[".editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-width:0 0 1px;border-color:var(--red-500)!important}"]})}}return n})();var lt=[{path:"",component:ke}],Fe=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=V({type:n})}static{this.\u0275inj=E({imports:[Q.forChild(lt),Q]})}}return n})();var ei=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=V({type:n})}static{this.\u0275inj=E({imports:[k,ae,Fe,N,pe,R,q,be,ge,fe,Ee,Ve,B,he]})}}return n})();export{ei as UserDeliverModule};
