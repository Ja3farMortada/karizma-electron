import{a as se}from"./chunk-536U5RBK.js";import"./chunk-CVZMK6Q5.js";import{a as We}from"./chunk-75KS2HX3.js";import{a as nt}from"./chunk-6AMBXUQL.js";import{a as Le}from"./chunk-6HTKW57C.js";import{a as me}from"./chunk-YAMBQIRM.js";import{a as Re}from"./chunk-5AMFDQWK.js";import"./chunk-MB5UDTNQ.js";import"./chunk-OWTGQR6U.js";import{a as Y,b as Qe}from"./chunk-DVHYHQJ7.js";import"./chunk-425U57QI.js";import{a as K}from"./chunk-GSMGX6RX.js";import{a as ze,b as Ae}from"./chunk-7LKCTRLS.js";import{A as Oe,B as je,F as qe,i as ae,j as Be,p as B,q as Ne,v as N}from"./chunk-DNVA5LVB.js";import{b as q,c as oe}from"./chunk-QLTZVGSE.js";import{$b as F,$c as Pe,Ba as C,C as Z,Ca as d,D as ee,Da as c,Ec as R,Fc as P,G as u,Ga as xe,Gc as ke,H as I,Hc as $,I as te,Ic as Me,Ma as l,N as De,Na as _,Nb as ue,O as v,Oa as D,P as h,Qa as w,Ra as E,Sa as T,Sb as Ee,T as ce,Va as x,Wa as ie,_c as G,a as X,aa as a,ba as de,cb as y,d as Se,db as b,dc as W,ha as H,hc as k,ic as z,jc as Te,ka as g,kc as _e,lc as Ie,ma as s,mc as A,oc as Q,pa as O,pc as U,qb as ne,rc as le,sb as j,sc as He,tc as Ve,uc as M,v as pe,va as i,vb as V,vc as Fe,wa as n,xa as f,xb as we,zb as re}from"./chunk-E4UPHNBD.js";import{g as it}from"./chunk-WWX6BADO.js";var J=(()=>{class t{constructor(){this.api=u(oe),this.notificationService=u(q),this.http=u(re),this.deliverHistory=H([]),this.moneyTransfersHistory=H([]),this.isLoading=H(!1),this.loadingReceivedDeliveries=H(!1),this.receivedDeliveries=H([])}fetchDeliverHistory(e){this.isLoading.set(!0),this.api.post("user-history/deliver/search",e).pipe(pe(()=>this.isLoading.set(!1))).subscribe({next:o=>{this.deliverHistory.set(o)}})}fetchReceivedDeliveries(e){this.loadingReceivedDeliveries.set(!0),this.api.post("user-history/received-deliveries/search",e).pipe(pe(()=>this.loadingReceivedDeliveries.set(!1))).subscribe({next:o=>{this.receivedDeliveries.set(o)}})}fetchMoneyTransferHistory(e){this.isLoading.set(!0),this.http.post(`${this.api.host}/user-history/money-transfer/search`,e).subscribe({next:o=>{this.moneyTransfersHistory.set(o),this.isLoading.set(!1)},error:o=>{this.isLoading.set(!1),this.notificationService.handleError(o.error,"home")}})}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=Z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ot=()=>[10,25,50],lt=()=>({width:"95vw"});function at(t,p){t&1&&(i(0,"tr")(1,"th"),l(2,"From"),n(),i(3,"th"),l(4,"Datetime"),n(),i(5,"th"),l(6,"Invoice #"),n(),i(7,"th"),l(8,"Total"),n(),i(9,"th",17),l(10,"Options"),n()())}function st(t,p){if(t&1){let e=C();i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td"),l(6),n(),i(7,"td"),l(8),y(9,"currency"),n(),i(10,"td")(11,"button",18),d("click",function(){let r=v(e).$implicit,m=c();return h(m.showInvoiceDialog(r))}),n()()()}if(t&2){let e=p.$implicit;a(2),_(e.first_name),a(2),_(e.order_date),a(2),_(e.invoice_number||"---"),a(2),_(b(9,4,e.total_price))}}function mt(t,p){t&1&&(i(0,"tr")(1,"td",19),l(2,"No Records Found!"),n()())}function pt(t,p){t&1&&(i(0,"tr")(1,"th",22),l(2,"Description"),n(),i(3,"th",23),l(4,"Unit Price"),n(),i(5,"th",23),l(6,"Qty"),n(),i(7,"th",24),l(8,"Total"),n()())}function ct(t,p){if(t&1&&(i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),y(5,"currency"),n(),i(6,"td"),l(7),n(),i(8,"td"),l(9),y(10,"currency"),n()()),t&2){let e=p.$implicit;a(2),_(e.product_name),a(2),_(b(5,4,e.unit_price)),a(3),_(e.quantity),a(2),D(" ",b(10,6,e.unit_price*e.quantity)," ")}}function dt(t,p){if(t&1&&(i(0,"tr"),f(1,"td")(2,"td"),i(3,"td"),l(4),n(),i(5,"td"),l(6),y(7,"currency"),n()()),t&2){let e=c(3);a(4),D(" ",e.selectedInvoiceTotals.totalQty," "),a(2),D(" Total: ",b(7,2,e.selectedDeliver.total_price)," ")}}function ut(t,p){if(t&1&&(i(0,"p-table",21),g(1,pt,9,0,"ng-template",11)(2,ct,11,8,"ng-template",12)(3,dt,8,4,"ng-template",16),n()),t&2){let e=c(2);s("value",e.deliverItems)}}function _t(t,p){if(t&1&&g(0,ut,4,1,"p-table",20),t&2){let e=c();s("ngIf",e.deliverItems.length!=0)}}function vt(t,p){if(t&1){let e=C();i(0,"button",25),d("click",function(){v(e);let r=c();return h(r.hideInvoiceDialog())}),n()}}var Ke=(()=>{class t{constructor(){this.fb=u(le),this.userHistory=u(J),this.dateService=u(K),this.decimalService=u(Le),this.receivedDeliveries=this.userHistory.receivedDeliveries,this.loadingReceivedDeliveries=this.userHistory.loadingReceivedDeliveries,this.detailsDialogVisible=!1,this.deliverItems=[],this.selectedInvoiceTotals={totalQty:0},this.searchForm=this.fb.group({invoice_number:[null],order_date:[null]}),this.submitSearch()}submitSearch(){this.searchForm.value.order_date&&this.searchForm.patchValue({order_date:this.dateService.formatDate(this.searchForm.value.order_date)}),this.userHistory.fetchReceivedDeliveries(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.userHistory.fetchReceivedDeliveries(null)}showInvoiceDialog(e){this.selectedDeliver=e,this.deliverItems=e.items,this.deliverItems.forEach(o=>{this.selectedInvoiceTotals.totalQty+=o.quantity}),this.detailsDialogVisible=!0}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0}}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=I({type:t,selectors:[["app-received-deliveries"]],decls:20,vars:22,consts:[[1,"grid","m-1"],[1,"col-12","md:col-8","md:col-offset-2"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","order_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["width","5%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["colspan","11"],["dataKey","product_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","product_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","10%"],["width","20%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(o,r){o&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return r.submitSearch()}),i(5,"div",4)(6,"div",5),f(7,"p-calendar",6),n(),i(8,"div",5),f(9,"input",7),n(),i(10,"div",5),f(11,"p-button",8),i(12,"p-button",9),d("onClick",function(){return r.resetSearch()}),n()()()()(),i(13,"p-table",10),g(14,at,11,0,"ng-template",11)(15,st,12,6,"ng-template",12)(16,mt,3,0,"ng-template",13),n()()()(),i(17,"p-dialog",14),T("visibleChange",function(S){return E(r.detailsDialogVisible,S)||(r.detailsDialogVisible=S),S}),d("onHide",function(){return r.hideInvoiceDialog()}),g(18,_t,1,1,"ng-template",15)(19,vt,1,0,"ng-template",16),n()),o&2&&(a(3),s("toggleable",!0),a(),s("formGroup",r.searchForm),a(3),s("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(4),s("loading",r.loadingReceivedDeliveries()),a(),s("disabled",r.loadingReceivedDeliveries()),a(),s("value",r.receivedDeliveries())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",x(20,ot))("alwaysShowPaginator",!1)("loading",r.loadingReceivedDeliveries()),a(4),O(x(21,lt)),w("visible",r.detailsDialogVisible),s("modal",!0)("closable",!0)("maximizable",!0))},dependencies:[j,A,W,k,z,Q,U,M,F,N,R,P,Y,B,$,G,V]})}}return t})();var Ye=it(nt());var ht=()=>[10,25,50];function ft(t,p){t&1&&(i(0,"tr")(1,"th"),l(2,"Invoice #"),n(),i(3,"th"),l(4,"Datetime"),n(),i(5,"th"),l(6,"total"),n(),i(7,"th",15),l(8,"Options"),n()())}function gt(t,p){if(t&1){let e=C();i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td"),l(6),y(7,"currency"),n(),i(8,"td")(9,"button",16),d("click",function(){let r=v(e).$implicit,m=c();return h(m.printInvoice(r))}),n()(),i(10,"td")(11,"button",17),d("click",function(){let r=v(e).$implicit,m=c();return h(m.openEditDialog(r))}),n()()()}if(t&2){let e=p.$implicit;a(2),_(e.journal_number),a(2),_(e.payment_date),a(2),_(b(7,3,e.total_value))}}function yt(t,p){t&1&&(i(0,"tr")(1,"td",18),l(2,"No Records Found!"),n()())}var Je=(()=>{class t{constructor(e,o){this.historyService=e,this.balanceService=o,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new X,this.transfersHistory=this.historyService.moneyTransfersHistory,this.loading=this.historyService.isLoading,this.searchForm=new Te({payment_date:new _e(null),payment_number:new _e(null)})}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=(0,Ye.default)(this.searchForm.value.payment_date).format("YYYY-MM-DD")),this.historyService.fetchMoneyTransferHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchMoneyTransferHistory(null)}showInvoiceDialog(e){}printInvoice(e){}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){this.balanceService.getBalance(),this.historyService.fetchMoneyTransferHistory(this.searchForm.value)}static{this.\u0275fac=function(o){return new(o||t)(de(J),de(We))}}static{this.\u0275cmp=I({type:t,selectors:[["app-money-transfer-history"]],decls:18,vars:17,consts:[[1,"grid","m-1"],[1,"col-12","md:col-8","md:col-offset-2"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","payment_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["dialog_mode","edit",3,"OnClose","OnSubmit","visible","selected_payment"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(o,r){o&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return r.submitSearch()}),i(5,"div",4)(6,"div",5),f(7,"p-calendar",6),n(),i(8,"div",5),f(9,"input",7),n(),i(10,"div",5),f(11,"p-button",8),i(12,"p-button",9),d("onClick",function(){return r.resetSearch()}),n()()()()(),i(13,"p-table",10),g(14,ft,9,0,"ng-template",11)(15,gt,12,5,"ng-template",12)(16,yt,3,0,"ng-template",13),n()()()(),i(17,"money-transfer-dialog",14),d("OnClose",function(){return r.hidePaymentDialog()})("OnSubmit",function(S){return r.getPaymentDilogResult(S)}),n()),o&2&&(a(3),s("toggleable",!0),a(),s("formGroup",r.searchForm),a(3),s("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(4),s("loading",r.loading()),a(),s("disabled",r.loading()),a(),s("value",r.transfersHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",x(16,ht))("alwaysShowPaginator",!1)("loading",r.loading()),a(4),s("visible",r.editDialogVisible)("selected_payment",r.selectedPayment))},dependencies:[A,W,k,z,Q,U,M,F,N,R,P,Y,B,$,se,V]})}}return t})();var Xe=(()=>{class t{constructor(){this.http=u(re),this.api=u(oe),this.notificationService=u(q),this.dateService=u(K),this.host=this.api.host,this.checkoutLoading=H(!1),this.action_status$=new Se(null)}edit_checkout(e,o){this.checkoutLoading.set(!0),this.http.put(`${this.host}/deliver/invoice`,{order:e,items:o}).subscribe({next:r=>{this.notificationService.showSuccess(r.message,"home"),this.checkoutLoading.set(!1)},error:r=>{this.notificationService.handleError(r.error,"home"),this.checkoutLoading.set(!1),r.status===400&&this.action_status$.next("APROVED")},complete:()=>{this.action_status$.next("UPDATE")}})}deleteInvoice(e){this.checkoutLoading.set(!0),this.http.delete(`${this.host}/deliver/invoice/${e}`).subscribe({next:o=>{this.notificationService.showSuccess(o.message,"home")},error:o=>{this.notificationService.handleError(o.error,"home"),this.checkoutLoading.set(!1),o.status===400&&this.action_status$.next("APROVED")},complete:()=>{this.action_status$.next("DELETE"),this.checkoutLoading.set(!1)}})}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=Z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ct=()=>({width:"95vw",height:"75vh"}),St=t=>({"ng-invalid ng-dirty":t}),Dt=t=>({invalid:t}),xt=t=>({"text-red-500":t});function wt(t,p){t&1&&(i(0,"small",25),l(1,"User is required."),n())}function Et(t,p){t&1&&(i(0,"tr")(1,"th",26),l(2,"#"),n(),i(3,"th",27),l(4,"Description"),n(),i(5,"th",28),l(6,"Unit"),n(),i(7,"th",29),l(8,"Qty"),n(),i(9,"th",28),l(10,"Total"),n(),i(11,"th",26),l(12,"Del?"),n()())}function Tt(t,p){if(t&1){let e=C();i(0,"p-inputNumber",35),T("ngModelChange",function(r){v(e);let m=c().$implicit;return E(m.quantity,r)||(m.quantity=r),h(r)}),d("onFocus",function(r){v(e);let m=c(3);return h(m.select(r.target))})("ngModelChange",function(){v(e);let r=c().$implicit,m=c(2);return h(m.setQty(r))}),n()}if(t&2){let e=c().$implicit;w("ngModel",e.quantity)}}function It(t,p){if(t&1&&(i(0,"span",36),l(1),n()),t&2){let e=c().$implicit;s("ngClass",ie(2,xt,!e.quantity)),a(),_(e.quantity)}}function Ht(t,p){if(t&1){let e=C();i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td"),l(6),y(7,"currency"),n(),i(8,"td",30)(9,"p-cellEditor"),g(10,Tt,1,1,"ng-template",31)(11,It,2,4,"ng-template",32),n()(),i(12,"td"),l(13),y(14,"currency"),n(),i(15,"td",33),d("click",function(){let r=v(e).rowIndex,m=c(2);return h(m.removeRow(r))}),f(16,"i",34),n()()}if(t&2){let e=p.$implicit,o=p.rowIndex;a(2),_(o+1),a(2),_(e.product_name),a(2),_(b(7,6,e.unit_price)),a(2),s("pEditableColumn",e.quantity)("ngClass",ie(10,Dt,!e.quantity)),a(5),D(" ",b(14,8,e.unit_price*e.quantity)," ")}}function Vt(t,p){}function Ft(t,p){t&1&&(i(0,"tr",37)(1,"td",38),l(2,"No data yet!"),n()())}function kt(t,p){if(t&1){let e=C();i(0,"button",39),d("click",function(){v(e);let r=c(2);return h(r.openProductsDialog())}),n()}}function Mt(t,p){}function Rt(t,p){if(t&1){let e=C();i(0,"div",4)(1,"div",5)(2,"p-card",6)(3,"div",7)(4,"div",5)(5,"div")(6,"div",8)(7,"label",9),l(8,"Invoice Date"),n(),i(9,"p-calendar",10),T("ngModelChange",function(r){v(e);let m=c();return E(m.deliverInfo.order_datetime,r)||(m.deliverInfo.order_datetime=r),h(r)}),n()()()(),i(10,"div",5)(11,"div")(12,"div",8)(13,"label",11),l(14,"User"),n(),i(15,"p-dropdown",12),T("ngModelChange",function(r){v(e);let m=c();return E(m.deliverInfo.database_id,r)||(m.deliverInfo.database_id=r),h(r)}),d("onChange",function(){v(e);let r=c();return h(r.validate())}),n(),g(16,wt,2,0,"small",13),n()()()()()(),i(17,"div",5)(18,"p-card",14)(19,"h1",15)(20,"span",16),l(21,"Total: "),n(),l(22),y(23,"currency"),n()()(),i(24,"div",17)(25,"p-card",14)(26,"p-table",18,0),g(28,Et,13,0,"ng-template",19)(29,Ht,17,12,"ng-template",2)(30,Vt,0,0,"ng-template",20)(31,Ft,3,0,"ng-template",21),n(),i(32,"p-toolbar",22),g(33,kt,1,0,"ng-template",23)(34,Mt,0,0,"ng-template",24),n()()()()}if(t&2){let e=c();a(9),w("ngModel",e.deliverInfo.order_datetime),s("readonlyInput",!0)("iconDisplay","input")("showIcon",!0),a(6),w("ngModel",e.deliverInfo.database_id),s("options",e.users())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("ngClass",ie(18,St,e.userInvalid)),a(),s("ngIf",e.userInvalid),a(6),D("",b(23,16,e.invoiceTotal)," "),a(4),xe("scrollHeight",e.vh),s("value",e.deliverInvoice)("scrollable",!0)("loading",e.checkoutLoading())}}function Pt(t,p){if(t&1){let e=C();i(0,"button",40),d("click",function(){v(e);let r=c();return h(r.deleteInvoice())}),n(),i(1,"button",41),d("click",function(){v(e);let r=c();return h(r.closeEditDialog())}),n(),i(2,"p-button",42),d("click",function(){v(e);let r=c();return h(r.submitEditInvoice())}),n()}if(t&2){let e=c();s("disabled",e.checkoutLoading()),a(),s("disabled",e.checkoutLoading()),a(),s("loading",e.checkoutLoading())("disabled",e.deliverInvoice.length==0||!e.deliverInfo.database_id)}}var Ze=(()=>{class t{constructor(){this.editDeliverService=u(Xe),this.stockService=u(Re),this.deliverService=u(me),this.notificationService=u(q),this.confirmationService=u(Ee),this.visible=!1,this.onSubmit=new ce,this.onHide=new ce,this.vh=75,this.dialogVisible=!1,this.products=this.stockService.products,this.users=this.deliverService.users,this.userInvalid=!1,this.checkoutLoading=this.editDeliverService.checkoutLoading,this.deliverInvoice=[],this.subscriptions=new X}ngOnInit(){this.editDeliverService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE"||e==="APROVED")&&(this.onSubmit.emit(!0),this.editDeliverService.action_status$.next(null))})}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.selectedDeliver&&(this.deliverInfo={order_id:this.selectedDeliver.order_id,database_id:this.selectedDeliver.database_id,invoice_number:this.selectedDeliver.invoice_number,order_datetime:this.selectedDeliver.order_datetime,total_price:this.selectedDeliver.total_price,notes:this.selectedDeliver.notes},this.deliverInvoice=structuredClone(this.selectedDeliver.items),this.invoiceTotal=this.selectedDeliver.total_price)}addProduct(e){let o=this.deliverInvoice.findIndex(r=>r.product_id===e.product_id);o!==-1?(this.deliverInvoice[o].quantity+=1,this.deliverInvoice=this.deliverInvoice):this.deliverInvoice=[...this.deliverInvoice,{product_id:e.product_id,product_name:e.product_name,quantity:1,unit_price:e.unit_cost_usd}],this.calculateTotal()}openProductsDialog(){this.dialogVisible=!0}closeProductsDialog(){this.dialogVisible=!1}assignSelectedProducts(e){this.dialogVisible=!1,e.forEach(o=>{this.addProduct(o)})}validate(){this.userInvalid=!1}select(e){e.select()}setPrice(e){e.unit_price,this.calculateTotal()}setQty(e){this.calculateTotal()}removeRow(e){let o=this.deliverInvoice;this.deliverInvoice=[...o.slice(0,e),...o.slice(e+1)],this.calculateTotal()}calculateTotal(){let e=0,o=this.deliverInvoice;return o.length>0&&o.forEach(r=>{e+=r.unit_price*r.quantity}),this.invoiceTotal=e,e}submitEditInvoice(){let e=0;this.deliverInvoice.forEach(o=>{o.quantity||e++}),e===0?this.confirmationService.confirm({key:"home",message:'Are you sure that you want to continue"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.deliverInfo.total_price=this.invoiceTotal,this.editDeliverService.edit_checkout(this.deliverInfo,this.deliverInvoice)}}):this.notificationService.showError("Quantity cannot be 0","home")}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete this invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.editDeliverService.deleteInvoice(this.selectedDeliver.order_id)}})}closeEditDialog(){this.onHide.emit(!1)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=I({type:t,selectors:[["edit-deliver"]],inputs:{visible:"visible",selectedDeliver:"selectedDeliver"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[De],decls:3,vars:7,consts:[["invoiceTable",""],["header","Edit Deliver","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[1,"grid","m-1"],[1,"col-12","md:col-6"],["styleClass","p-0",1,"no-padding"],[1,"grid"],[1,"flex","flex-column","gap-2"],["for","order_datetime"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small",3,"ngModelChange","ngModel","readonlyInput","iconDisplay","showIcon"],["for","user"],["styleClass","p-inputtext-sm w-full","id","user","appendTo","body","optionLabel","first_name","optionValue","user_id","placeholder","Select User","filterBy","first_name",1,"ng-invalid","ng-dirty",3,"ngModelChange","onChange","ngModel","options","filter","showClear","autoOptionFocus","ngClass"],["class","p-error",4,"ngIf"],[1,"no-padding"],[1,"text-center","mt-0","mb-0","lg:mt-3","lg:mb-3"],[1,"text-green-500"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines mt-3",3,"value","scrollable","scrollHeight","loading"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],["styleClass","mt-2 p-2"],["pTemplate","left"],["pTemplate","right"],[1,"p-error"],["width","5%"],["width","40%"],["width","20%"],["width","10%"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["min","1","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[3,"ngClass"],[1,"surface-300"],["colspan","6"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list","autofocus","true","pAutoFocus","",1,"p-button-sm","ml-2",3,"click"],["pButton","","pRipple","","label","Delete","icon","pi pi-trash","severity","danger",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"],["pButton","","pRipple","","label","Cancel Edit","icon","pi pi-times",1,"p-button-secondary","w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["pRipple","","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"]],template:function(o,r){o&1&&(i(0,"p-dialog",1),T("visibleChange",function(S){return E(r.visible,S)||(r.visible=S),S}),d("onHide",function(){return r.closeEditDialog()}),g(1,Rt,35,20,"ng-template",2)(2,Pt,3,4,"ng-template",3),n()),o&2&&(O(x(6,Ct)),w("visible",r.visible),s("modal",!0)("closable",!1)("maximizable",!0))},dependencies:[ne,j,k,Ie,M,F,N,Oe,je,R,P,B,G,ae,ze,V]})}}return t})();var Nt=()=>[10,25,50],Lt=()=>({width:"95vw"});function Ot(t,p){t&1&&(i(0,"tr")(1,"th"),l(2,"User"),n(),i(3,"th"),l(4,"Datetime"),n(),i(5,"th"),l(6,"Invoice #"),n(),i(7,"th"),l(8,"total"),n(),i(9,"th"),l(10,"Approved"),n(),i(11,"th",19),l(12,"Options"),n()())}function jt(t,p){if(t&1){let e=C();i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),n(),i(5,"td"),l(6),n(),i(7,"td"),l(8),y(9,"currency"),n(),i(10,"td"),f(11,"i",20),n(),i(12,"td")(13,"button",21),d("click",function(){let r=v(e).$implicit,m=c();return h(m.showInvoiceDialog(r))}),n()(),i(14,"td"),f(15,"button",22),n(),i(16,"td")(17,"button",23),d("click",function(){let r=v(e).$implicit,m=c();return h(m.editDeliver(r))}),n()()()}if(t&2){let e=p.$implicit;a(2),_(e.first_name),a(2),_(e.order_datetime),a(2),_(e.invoice_number||"---"),a(2),_(b(9,6,e.total_price)),a(3),s("ngClass",e.is_approved?"pi pi-check text-green-500":"pi pi-history text-gray-500"),a(6),s("disabled",e.is_approved)}}function qt(t,p){t&1&&(i(0,"tr")(1,"td",24),l(2,"No Records Found!"),n()())}function Wt(t,p){t&1&&(i(0,"tr")(1,"th",27),l(2,"Description"),n(),i(3,"th",28),l(4,"Unit Price"),n(),i(5,"th",29),l(6,"Qty"),n(),i(7,"th",28),l(8,"Total Price"),n()())}function zt(t,p){if(t&1&&(i(0,"tr")(1,"td"),l(2),n(),i(3,"td"),l(4),y(5,"currency"),n(),i(6,"td"),l(7),n(),i(8,"td"),l(9),y(10,"currency"),n()()),t&2){let e=p.$implicit;a(2),_(e.product_name),a(2),D(" ",b(5,4,e.unit_price)," "),a(3),_(e.quantity),a(2),D(" ",b(10,6,e.quantity*e.unit_price)," ")}}function At(t,p){if(t&1&&(i(0,"tr"),f(1,"td")(2,"td"),i(3,"td"),l(4),n(),i(5,"td"),l(6),y(7,"currency"),n()()),t&2){let e=c(3);a(4),_(e.selectedInvoiceTotals.totalQty),a(2),D("Total: ",b(7,2,e.selectedDeliver.total_price),"")}}function Qt(t,p){if(t&1&&(i(0,"p-table",26),g(1,Wt,9,0,"ng-template",12)(2,zt,11,8,"ng-template",13)(3,At,8,4,"ng-template",17),n()),t&2){let e=c(2);s("value",e.invoiceItems)}}function Ut(t,p){if(t&1&&g(0,Qt,4,1,"p-table",25),t&2){let e=c();s("ngIf",e.invoiceItems.length!=0)}}function $t(t,p){if(t&1){let e=C();i(0,"button",30),d("click",function(){v(e);let r=c();return h(r.hideInvoiceDialog())}),n()}}var et=(()=>{class t{constructor(){this.userHistory=u(J),this.deliverService=u(me),this.fb=u(le),this.dateService=u(K),this.deliverHistory=this.userHistory.deliverHistory,this.users=this.deliverService.users,this.isLoading=this.userHistory.isLoading,this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0},this.editDialogVisible=!1,this.searchForm=this.fb.group({invoice_number:[null],user_id:[null],order_date:[null]}),this.submitSearch()}submitSearch(){this.searchForm.value.order_date&&this.searchForm.patchValue({order_date:this.dateService.formatDate(this.searchForm.value.order_date)}),this.userHistory.fetchDeliverHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.userHistory.fetchDeliverHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.selectedDeliver=e,this.invoiceItems.forEach(o=>{this.selectedInvoiceTotals.totalQty+=o.quantity}),this.detailsDialogVisible=!0}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0}}editDeliver(e){this.selectedDeliver=e,this.editDialogVisible=!0}editDeliverSubmited(){this.editDialogVisible=!1,this.userHistory.fetchDeliverHistory(this.searchForm.value)}editDeliverDialogClosed(){this.editDialogVisible=!1}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=I({type:t,selectors:[["app-deliver-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","user_id","styleClass","p-inputtext-sm w-full","id","user","appendTo","body","optionLabel","first_name","optionValue","user_id","placeholder","Select User","filterBy","first_name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","order_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput","showTime","showSeconds"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","selectedDeliver"],["colspan","3","width","6%"],[1,"font-bold","text-lg",3,"ngClass"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click","disabled"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(o,r){o&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return r.submitSearch()}),i(5,"div",4)(6,"div",5),f(7,"p-dropdown",6),n(),i(8,"div",5),f(9,"p-calendar",7),n(),i(10,"div",5),f(11,"input",8),n(),i(12,"div",5),f(13,"p-button",9),i(14,"p-button",10),d("onClick",function(){return r.resetSearch()}),n()()()()(),i(15,"p-table",11),g(16,Ot,13,0,"ng-template",12)(17,jt,18,8,"ng-template",13)(18,qt,3,0,"ng-template",14),n()()()(),i(19,"p-dialog",15),T("visibleChange",function(S){return E(r.detailsDialogVisible,S)||(r.detailsDialogVisible=S),S}),d("onHide",function(){return r.hideInvoiceDialog()}),g(20,Ut,1,1,"ng-template",16)(21,$t,1,0,"ng-template",17),n(),i(22,"edit-deliver",18),d("onHide",function(){return r.editDeliverDialogClosed()})("onSubmit",function(){return r.editDeliverSubmited()}),n()),o&2&&(a(3),s("toggleable",!0),a(),s("formGroup",r.searchForm),a(3),s("options",r.users())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),s("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showTime",!0)("showSeconds",!0),a(4),s("loading",r.isLoading()),a(),s("disabled",r.isLoading()),a(),s("value",r.deliverHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",x(28,Nt))("alwaysShowPaginator",!1)("loading",r.isLoading()),a(4),O(x(29,Lt)),w("visible",r.detailsDialogVisible),s("modal",!0)("closable",!0)("maximizable",!0),a(3),s("visible",r.editDialogVisible)("selectedDeliver",r.selectedDeliver))},dependencies:[ne,j,A,W,k,z,Q,U,M,F,N,R,P,Y,B,$,G,ae,Ze,V]})}}return t})();var Gt=[{path:"received-deliveries",data:{breadcrumb:"Received Deliveries"},component:Ke},{path:"deliver-history",data:{breadcrumb:"Deliveries"},component:et},{path:"money-transfer-history",data:{breadcrumb:"money transfers"},component:Je}],tt=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=te({type:t})}static{this.\u0275inj=ee({imports:[ue.forChild(Gt),ue]})}}return t})();var dn=(()=>{class t{static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275mod=te({type:t})}static{this.\u0275inj=ee({imports:[we,Ve,He,tt,Fe,qe,ke,Qe,Ne,Me,Pe,se,Be,Ae]})}}return t})();export{dn as HistoryModule};
